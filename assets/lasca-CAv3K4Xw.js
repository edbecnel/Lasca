(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const c of n)if(c.type==="childList")for(const s of c.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&i(s)}).observe(document,{childList:!0,subtree:!0});function e(n){const c={};return n.integrity&&(c.integrity=n.integrity),n.referrerPolicy&&(c.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?c.credentials="include":n.crossOrigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function i(n){if(n.ep)return;n.ep=!0;const c=e(n);fetch(n.href,c)}})();const xe=["r0c0","r0c2","r0c4","r0c6","r1c1","r1c3","r1c5","r2c0","r2c2","r2c4","r2c6"],ke=["r4c0","r4c2","r4c4","r4c6","r5c1","r5c3","r5c5","r6c0","r6c2","r6c4","r6c6"],ve="r3c3",Ae=[{owner:"B",rank:"O"},{owner:"W",rank:"S"},{owner:"B",rank:"S"},{owner:"W",rank:"O"},{owner:"B",rank:"S"},{owner:"W",rank:"S"},{owner:"B",rank:"O"},{owner:"W",rank:"S"}];function Ce(){const r=new Map;for(const t of xe)r.set(t,[{owner:"B",rank:"S"}]);for(const t of ke)r.set(t,[{owner:"W",rank:"S"}]);return r.set(ve,Ae),{board:r,toMove:"W",phase:"select"}}function ie(r){return r.owner==="W"&&r.rank==="S"?"#W_S":r.owner==="W"&&r.rank==="O"?"#W_O":r.owner==="B"&&r.rank==="S"?"#B_S":"#B_O"}const Le="http://www.w3.org/2000/svg",Ee="http://www.w3.org/1999/xlink";function ce(r,t,e,i){const n=document.createElementNS(Le,"use");return n.setAttribute("href",r),n.setAttributeNS(Ee,"xlink:href",r),n.setAttribute("width",String(i)),n.setAttribute("height",String(i)),n.setAttribute("x",String(t)),n.setAttribute("y",String(e)),n}const J=6,oe=Math.floor(J/2),me=J-oe,R="http://www.w3.org/2000/svg";function Ie(r,t,e,i,n,c={}){const{pieceSize:s=86,maxShown:f=J,keepTop:u=me,keepBottom:l=oe,miniSize:o=18,miniGap:a=3,spineGap:h=10,spinePad:m=6,crackGap:w=12}=c,g=n.length;if(g<=1)return;let d=[],p=!1;if(g<=f)d=n.slice();else{p=!0;const B=n.slice(0,l),T=n.slice(g-u);d=B.concat(T)}const y=d.length,O=y*o+(y-1)*a+(p?w:0),v=o+m*2,C=O+m*2,S=e+s/2+h,A=i-C/2,x=document.createElementNS(R,"rect");x.setAttribute("x",String(S)),x.setAttribute("y",String(A)),x.setAttribute("width",String(v)),x.setAttribute("height",String(C)),x.setAttribute("rx","10"),x.setAttribute("fill","rgba(0,0,0,0.28)"),x.setAttribute("stroke","rgba(255,255,255,0.35)"),x.setAttribute("stroke-width","1.4"),x.setAttribute("pointer-events","none"),t.appendChild(x);const W=r.querySelector("defs");if(!W)throw new Error("SVG <defs> not found. miniSpine requires <defs>.");const M=`clip_${Math.random().toString(16).slice(2)}`,N=document.createElementNS(R,"clipPath");N.setAttribute("id",M);const L=document.createElementNS(R,"rect");L.setAttribute("x",String(S+1)),L.setAttribute("y",String(A+1)),L.setAttribute("width",String(v-2)),L.setAttribute("height",String(C-2)),L.setAttribute("rx","9"),N.appendChild(L),W.appendChild(N);const _=document.createElementNS(R,"g");_.setAttribute("clip-path",`url(#${M})`),_.setAttribute("pointer-events","none");const U=S+m,b=A+C-m,k=l-1;for(let B=0;B<y;B++){const T=d[B],F=ie(T);let H=B*(o+a);p&&B>k&&(H+=w);const K=b-o-H,q=U;_.appendChild(ce(F,q,K,o))}if(t.appendChild(_),p){const T=b-o-k*(o+a)-a-w/2,F=S+3,H=S+v-3,K=(F+H)/2,q=[`M ${F} ${T-5}`,`L ${K-6} ${T+2}`,`L ${K} ${T-3}`,`L ${K+6} ${T+4}`,`L ${H} ${T-1}`].join(" "),G=document.createElementNS(R,"path");G.setAttribute("d",q),G.setAttribute("fill","none"),G.setAttribute("stroke","rgba(0,0,0,0.45)"),G.setAttribute("stroke-width","4.0"),G.setAttribute("stroke-linecap","round"),G.setAttribute("stroke-linejoin","round"),G.setAttribute("pointer-events","none");const $=document.createElementNS(R,"path");$.setAttribute("d",q),$.setAttribute("fill","none"),$.setAttribute("stroke","rgba(255,255,255,0.75)"),$.setAttribute("stroke-width","2.2"),$.setAttribute("stroke-linecap","round"),$.setAttribute("stroke-linejoin","round"),$.setAttribute("pointer-events","none"),t.appendChild(G),t.appendChild($)}const I=S+v/2,Y=A-12,D=document.createElementNS(R,"circle");D.setAttribute("cx",String(I)),D.setAttribute("cy",String(Y)),D.setAttribute("r","10"),D.setAttribute("fill","rgba(0,0,0,0.78)"),D.setAttribute("stroke","rgba(255,255,255,0.65)"),D.setAttribute("stroke-width","1.4"),D.setAttribute("pointer-events","none");const E=document.createElementNS(R,"text");E.setAttribute("x",String(I)),E.setAttribute("y",String(Y+.5)),E.setAttribute("text-anchor","middle"),E.setAttribute("dominant-baseline","middle"),E.setAttribute("fill","#fff"),E.setAttribute("font-size","12"),E.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),E.textContent=String(g),E.setAttribute("pointer-events","none"),t.appendChild(D),t.appendChild(E)}function Be(r,t,e,i,n,c={}){const{pieceSize:s=86}=c,f=document.getElementById(i);if(!f||!n.length)return;const u=parseFloat(f.getAttribute("cx")||"0"),l=parseFloat(f.getAttribute("cy")||"0"),o=document.createElementNS("http://www.w3.org/2000/svg","g");o.setAttribute("data-node",i),o.setAttribute("class","stack");const a=n[n.length-1],h=s/2;o.appendChild(ce(ie(a),u-h,l-h,s)),Ie(r,o,u,l,n,{pieceSize:s,miniSize:18}),e&&n.length>1&&(o.style.cursor="pointer",o.addEventListener("pointerenter",()=>{e.cancelHide(),e.show(i,n)}),o.addEventListener("pointerleave",()=>{e.hideSoon()})),t.appendChild(o)}function ge(r,t,e,i){t.textContent="";for(const[n,c]of i.board.entries())Be(r,t,e,n,c)}const j="http://www.w3.org/2000/svg";function Ne(r,t,e){let i=null;function n(){for(;e.firstChild;)e.removeChild(e.firstChild);e.setAttribute("viewBox","0 0 120 200"),e.removeAttribute("height")}function c(u,l){const o=l.length;for(r.textContent=`Stack @ ${u} (×${o})`,t.textContent=o>J?"Full column order (bottom → top). Brackets mark pieces omitted in the mini preview spine.":"Full column order (bottom → top).";e.firstChild;)e.removeChild(e.firstChild);const a=22,h=4,m=26,w=24,g=120,d=o*a+(o-1)*h,p=m+d+w;e.setAttribute("viewBox",`0 0 ${g} ${p}`),e.setAttribute("height",String(p));const y=g/2-a/2,O=m,v=document.createElementNS(j,"rect");v.setAttribute("x",String(y-8)),v.setAttribute("y",String(O-10)),v.setAttribute("width",String(a+16)),v.setAttribute("height",String(d+20)),v.setAttribute("rx","12"),v.setAttribute("fill","rgba(0,0,0,0.28)"),v.setAttribute("stroke","rgba(255,255,255,0.18)"),v.setAttribute("stroke-width","1.4"),e.appendChild(v);const C=document.createElementNS(j,"text");C.setAttribute("x",String(g/2)),C.setAttribute("y",String(O-12)),C.setAttribute("text-anchor","middle"),C.setAttribute("fill","rgba(255,255,255,0.85)"),C.setAttribute("font-size","12"),C.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),C.textContent="TOP",e.appendChild(C);const S=document.createElementNS(j,"text");S.setAttribute("x",String(g/2)),S.setAttribute("y",String(O+d+18)),S.setAttribute("text-anchor","middle"),S.setAttribute("fill","rgba(255,255,255,0.85)"),S.setAttribute("font-size","12"),S.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),S.textContent="BOTTOM",e.appendChild(S);for(let A=0;A<o;A++){const x=l[A],W=ie(x),M=O+(o-1-A)*(a+h);e.appendChild(ce(W,y,M,a))}if(o>J){const A=oe,x=me,W=A,M=o-x-1;if(M>=W){const N=O+(o-1-M)*(a+h),L=O+(o-1-W)*(a+h)+a,_=y-18,U=y+a+18,b=10,k=document.createElementNS(j,"path");k.setAttribute("d",`M ${_+b} ${N} L ${_} ${N} L ${_} ${L} L ${_+b} ${L}`),k.setAttribute("fill","none"),k.setAttribute("stroke","rgba(255,255,255,0.90)"),k.setAttribute("stroke-width","2.2"),k.setAttribute("stroke-linecap","round"),k.setAttribute("stroke-linejoin","round"),e.appendChild(k);const I=document.createElementNS(j,"path");I.setAttribute("d",`M ${U-b} ${N} L ${U} ${N} L ${U} ${L} L ${U-b} ${L}`),I.setAttribute("fill","none"),I.setAttribute("stroke","rgba(255,255,255,0.90)"),I.setAttribute("stroke-width","2.2"),I.setAttribute("stroke-linecap","round"),I.setAttribute("stroke-linejoin","round"),e.appendChild(I)}}}function s(){i&&clearTimeout(i),i=null}function f(){i&&clearTimeout(i),i=setTimeout(()=>{r.textContent="Lasca Stack Inspector",t.textContent="Hover a stacked piece to see the full column order (bottom → top). If a crack appears on the mini spine, brackets mark the omitted middle here.",n()},80)}return{show:c,hideSoon:f,cancelHide:s,clearZoom:n}}const P="lasca.layout.",V=22,z={leftWidth:280,rightWidth:320,leftCollapsed:!1,rightCollapsed:!1};function X(r,t,e){return Math.max(t,Math.min(e,r))}function le(r,t){const e=localStorage.getItem(r);if(e==null)return t;const i=Number(e);return Number.isFinite(i)?i:t}function ae(r,t){const e=localStorage.getItem(r);return e==null?t:e==="1"}function de(r,t){localStorage.setItem(r,String(Math.round(t)))}function fe(r,t){localStorage.setItem(r,t?"1":"0")}function Te(r={}){const t=r.root??document.getElementById("appRoot"),e=r.left??document.getElementById("leftSidebar"),i=r.right??document.getElementById("rightSidebar"),n=r.gutterLeft??document.getElementById("gutterLeft"),c=r.gutterRight??document.getElementById("gutterRight");if(!t||!e||!i||!n||!c)throw new Error("splitLayout: missing root/sidebars/gutters");const s=t.querySelector('[data-action="collapse-left"]'),f=t.querySelector('[data-action="collapse-right"]'),u=t.querySelector('[data-action="expand-left"]'),l=t.querySelector('[data-action="expand-right"]'),o=420,a=200,h=520,m=240,w=560;let g=le(P+"leftWidth",z.leftWidth),d=le(P+"rightWidth",z.rightWidth),p=ae(P+"leftCollapsed",z.leftCollapsed),y=ae(P+"rightCollapsed",z.rightCollapsed),O=g,v=d;function C(){return t.getBoundingClientRect().width}function S(){return n.getBoundingClientRect().width+c.getBoundingClientRect().width}function A(){e.style.width=p?`${V}px`:`${g}px`,i.style.width=y?`${V}px`:`${d}px`,e.classList.toggle("collapsed",p),i.classList.toggle("collapsed",y),n.classList.toggle("disabled",p),c.classList.toggle("disabled",y),de(P+"leftWidth",g),de(P+"rightWidth",d),fe(P+"leftCollapsed",p),fe(P+"rightCollapsed",y)}function x(){const b=C(),k=y?V:d;return b-S()-k-o}function W(){const b=C(),k=p?V:g;return b-S()-k-o}function M(b){p!==b&&(b?O=g:g=X(O,a,Math.min(h,x())),p=b,A())}function N(b){y!==b&&(b?v=d:d=X(v,m,Math.min(w,W())),y=b,A())}function L(){p||(g=X(g,a,Math.min(h,x()))),y||(d=X(d,m,Math.min(w,W()))),A()}function _(b){if(p)return;const k=b.clientX,I=g,Y=Math.min(h,x()),D=a;function E(T){const F=T.clientX-k;g=X(I+F,D,Y),A()}function B(){window.removeEventListener("pointermove",E),window.removeEventListener("pointerup",B);try{n.releasePointerCapture(b.pointerId)}catch{}}n.setPointerCapture(b.pointerId),window.addEventListener("pointermove",E),window.addEventListener("pointerup",B)}function U(b){if(y)return;const k=b.clientX,I=d,Y=Math.min(w,W()),D=m;function E(T){const F=T.clientX-k;d=X(I-F,D,Y),A()}function B(){window.removeEventListener("pointermove",E),window.removeEventListener("pointerup",B);try{c.releasePointerCapture(b.pointerId)}catch{}}c.setPointerCapture(b.pointerId),window.addEventListener("pointermove",E),window.addEventListener("pointerup",B)}return n.addEventListener("pointerdown",_),c.addEventListener("pointerdown",U),n.addEventListener("dblclick",()=>M(!p)),c.addEventListener("dblclick",()=>N(!y)),s==null||s.addEventListener("click",()=>M(!0)),u==null||u.addEventListener("click",()=>M(!1)),f==null||f.addEventListener("click",()=>N(!0)),l==null||l.addEventListener("click",()=>N(!1)),L(),window.addEventListener("resize",L),{getState:()=>({leftWidth:g,rightWidth:d,leftCollapsed:p,rightCollapsed:y}),setLeftCollapsed:M,setRightCollapsed:N,setLeftWidth:b=>{g=b,L()},setRightWidth:b=>{d=b,L()}}}async function Me(r,t){if(!r)throw new Error("loadSvgFileInto: containerEl is required");const e=await fetch(t);if(!e.ok)throw new Error(`loadSvgFileInto: failed to fetch ${String(t)} (${e.status})`);const i=await e.text(),c=new DOMParser().parseFromString(i,"image/svg+xml").documentElement;if(!c||c.nodeName.toLowerCase()!=="svg")throw new Error(`loadSvgFileInto: ${String(t)} did not parse as an <svg> root`);const s=document.importNode(c,!0);return r.replaceChildren(s),s}async function De(r,t){if(!r)throw new Error("loadSvgDefsInto: targetEl is required");if(!(!Array.isArray(t)||t.length===0))for(const e of t){const i=await fetch(e);if(!i.ok)throw new Error(`loadSvgDefsInto: failed to fetch ${String(e)} (${i.status})`);const n=await i.text(),c=new DOMParser().parseFromString(n,"image/svg+xml"),s=c.querySelector("defs"),f=s?Array.from(s.children):Array.from(c.documentElement.children);for(const u of f)r.appendChild(document.importNode(u,!0))}}const te="classic",re=[{id:"classic",label:"Classic",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20PIECE%20SYMBOLS%20(W_S,%20B_S,%20W_O,%20B_O)%20========%20--%3e%3cradialGradient%20id='gradWhite'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ffffff'/%3e%3cstop%20offset='55%25'%20stop-color='%23f1f1f1'/%3e%3cstop%20offset='100%25'%20stop-color='%23d6d6d6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradBlack'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23444444'/%3e%3cstop%20offset='55%25'%20stop-color='%231c1c1c'/%3e%3cstop%20offset='100%25'%20stop-color='%23050505'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradGreen'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%237be58a'/%3e%3cstop%20offset='55%25'%20stop-color='%231fb34a'/%3e%3cstop%20offset='100%25'%20stop-color='%230a6f2a'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradRed'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ff8f8f'/%3e%3cstop%20offset='55%25'%20stop-color='%23e12a2a'/%3e%3cstop%20offset='100%25'%20stop-color='%238f1111'/%3e%3c/radialGradient%3e%3cpath%20id='star5'%20d='%20M%2050%2030%20L%2056.5%2043.2%20L%2071.0%2045.3%20L%2060.5%2055.6%20L%2063.0%2070.0%20L%2050.0%2063.2%20L%2037.0%2070.0%20L%2039.5%2055.6%20L%2029.0%2045.3%20L%2043.5%2043.2%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradWhite)'%20stroke='%23111'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.28'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradBlack)'%20stroke='%23f5f5f5'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.16'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.10'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradGreen)'%20stroke='%230b2a12'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.18'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradRed)'%20stroke='%233a0b0b'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.16'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvY2xhc3NpYy90aGVtZS5jc3MgKi8KOnJvb3R7CiAgLS1wYWdlLWJnOiAjMWIxYjFiOwogIC0tcGFuZWwtYmc6IHJnYmEoMjU1LDI1NSwyNTUsMC4wNik7CiAgLS1wYW5lbC1ib3JkZXI6IHJnYmEoMjU1LDI1NSwyNTUsMC4xMCk7CiAgLS1wYW5lbC10ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuOTApOwogIC0tcGFuZWwtc3VidGV4dDogcmdiYSgyNTUsMjU1LDI1NSwwLjcwKTsKfQoKLyogU2xpZ2h0bHkgd2FybSBib2FyZCBjb25uZWN0b3JzL25vZGVzICovCiNsYXNjYUJvYXJkICNjb25uZWN0b3JzeyBzdHJva2U6ICMxMTE7IH0KI2xhc2NhQm9hcmQgI25vZGVzeyBzdHJva2U6ICMxMTE7IH0K",import.meta.url)},{id:"highContrast",label:"High Contrast",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20High-contrast%20flat%20pieces:%20same%20IDs%20(%23W_S,%20%23B_S,%20%23W_O,%20%23B_O)%20--%3e%3cpath%20id='star5'%20d='%20M%2050%2025%20L%2058%2042%20L%2077%2045%20L%2063%2058%20L%2066%2077%20L%2050%2068%20L%2034%2077%20L%2037%2058%20L%2023%2045%20L%2042%2042%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ffffff'%20stroke='%23000000'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23000000'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23000'%20opacity='0.06'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23000000'%20stroke='%23ffffff'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23ffffff'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.12'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%2321c75a'%20stroke='%23001a08'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ff2a2a'%20stroke='%231a0000'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvaGlnaENvbnRyYXN0L3RoZW1lLmNzcyAqLwo6cm9vdHsKICAtLXBhZ2UtYmc6ICMwYjBiMGI7CiAgLS1wYW5lbC1iZzogcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTsKICAtLXBhbmVsLWJvcmRlcjogcmdiYSgyNTUsMjU1LDI1NSwwLjE0KTsKICAtLXBhbmVsLXRleHQ6IHJnYmEoMjU1LDI1NSwyNTUsMC45NCk7CiAgLS1wYW5lbC1zdWJ0ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuNzgpOwp9CgovKiBNYWtlIGJvYXJkIGxpbmVzL3JpbmdzIG1vcmUgdmlzaWJsZSAqLwojbGFzY2FCb2FyZCAjY29ubmVjdG9yc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CiNsYXNjYUJvYXJkICNub2Rlc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CgovKiBCb29zdCBzcGluZSBidWJibGUgY29udHJhc3QgKi8KI2xhc2NhQm9hcmQgdGV4dHsgcGFpbnQtb3JkZXI6IHN0cm9rZTsgc3Ryb2tlOiByZ2JhKDAsMCwwLDAuNTUpOyBzdHJva2Utd2lkdGg6IDJweDsgfQo=",import.meta.url)}];function Q(r){return re.find(t=>t.id===r)??null}function Oe(r){const{rootEl:t,items:e,initialId:i,onSelect:n}=r??{};if(!t)throw new Error("createThemeDropdown: rootEl is required");if(!Array.isArray(e)||e.length===0)throw new Error("createThemeDropdown: items is required");const c=t.querySelector("#themeDropdownBtn"),s=t.querySelector("#themeDropdownMenu");if(!c||!s)throw new Error("createThemeDropdown: missing #themeDropdownBtn / #themeDropdownMenu");let f=!1,u=i??e[0].id;function l(d){f=d,c.setAttribute("aria-expanded",f?"true":"false"),f?(s.hidden=!1,s.focus({preventScroll:!0})):s.hidden=!0}function o(){const d=e.find(p=>p.id===u)??e[0];c.textContent=d?`${d.label} ▾`:"Theme ▾"}function a(){s.textContent="";for(const d of e){const p=document.createElement("button");p.type="button",p.className="themeOption",p.setAttribute("role","option"),p.setAttribute("data-id",d.id),p.setAttribute("aria-selected",d.id===u?"true":"false"),p.textContent=d.label,p.addEventListener("click",async()=>{await h(d.id),l(!1),c.focus({preventScroll:!0})}),s.appendChild(p)}}async function h(d){u=d,o(),a(),typeof n=="function"&&await n(d)}function m(d){if(!f)return;const p=d.target;p instanceof Node&&(t.contains(p)||l(!1))}function w(){l(!f)}function g(d){f&&d.key==="Escape"&&(d.preventDefault(),l(!1),c.focus({preventScroll:!0}))}return c.addEventListener("click",w),document.addEventListener("pointerdown",m),s.addEventListener("keydown",g),c.setAttribute("aria-haspopup","listbox"),s.setAttribute("role","listbox"),s.tabIndex=-1,o(),a(),l(!1),{setSelected:async d=>h(d),getSelected:()=>u,open:()=>l(!0),close:()=>l(!1),destroy:()=>{c.removeEventListener("click",w),document.removeEventListener("pointerdown",m),s.removeEventListener("keydown",g)}}}const be="lasca.theme",ue="lascaThemeCss";function We(r){const t="http://www.w3.org/2000/svg";let e=r.querySelector("defs");e||(e=document.createElementNS(t,"defs"),e.setAttribute("id","lascaDefs"),r.insertBefore(e,r.firstChild));let i=r.querySelector("#lascaThemeDefs");i||(i=document.createElementNS(t,"g"),i.setAttribute("id","lascaThemeDefs"),e.appendChild(i));let n=r.querySelector("#lascaRuntimeDefs");return n||(n=document.createElementNS(t,"g"),n.setAttribute("id","lascaRuntimeDefs"),e.appendChild(n)),{defs:e,themeDefs:i,runtimeDefs:n}}function _e(){let r=document.getElementById(ue);return r&&r.tagName.toLowerCase()!=="link"&&(r.remove(),r=null),r||(r=document.createElement("link"),r.id=ue,r.rel="stylesheet",document.head.appendChild(r)),r}function he(){const r=localStorage.getItem(be);return r||null}function Ue(r){localStorage.setItem(be,r)}function Fe(r){if(!r)throw new Error("createThemeManager: svgRoot is required");const{themeDefs:t}=We(r);let e=null,i=null;async function n(u){if(!u)return;const l=String(u);if(l===i)return;const o=_e();await new Promise(a=>{const h=()=>{o.removeEventListener("load",h),o.removeEventListener("error",h),a()};o.addEventListener("load",h),o.addEventListener("error",h),o.href=l}),i=l}async function c(u){const l=Q(u)??Q(te);if(!l)throw new Error("No themes available.");if(e===l.id)return l;const o=r.style.visibility;return r.style.visibility="hidden",t.replaceChildren(),await De(t,[l.piecesDefs,l.boardDefs]),await n(l.css),e=l.id,Ue(e),r.style.visibility=o||"visible",l}async function s(u){if(!u)return;const l=re.map(m=>({id:m.id,label:m.label})),o=he(),a=o&&Q(o)?o:te;await c(a),await Oe({rootEl:u,items:l,initialId:a,onSelect:async m=>{await c(m)}}).setSelected(a)}async function f(u){if(!u)return;u.textContent="";for(const a of re){const h=document.createElement("option");h.value=a.id,h.textContent=a.label,u.appendChild(h)}const l=he(),o=l&&Q(l)?l:te;u.value=o,await c(o),u.addEventListener("change",async()=>{await c(u.value)})}return{setTheme:c,bindThemeDropdown:s,bindThemeSelect:f,getCurrentThemeId:()=>e}}const se="http://www.w3.org/2000/svg";function we(r){const t=r.querySelector("#overlays");if(t)return t;const e=document.createElementNS(se,"g");e.id="overlays",e.setAttribute("pointer-events","none");const i=r.querySelector("#pieces");return i&&i.parentNode?i.nextSibling?i.parentNode.insertBefore(e,i.nextSibling):i.parentNode.appendChild(e):r.appendChild(e),e}function pe(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function ye(r){return document.getElementById(r)}function Ge(r,t){const e=ye(t);if(!e)return;const i=parseFloat(e.getAttribute("cx")||"0"),n=parseFloat(e.getAttribute("cy")||"0"),c=parseFloat(e.getAttribute("r")||"0"),s=document.createElementNS(se,"circle");s.setAttribute("cx",String(i)),s.setAttribute("cy",String(n)),s.setAttribute("r",String(c+6)),s.setAttribute("fill","none"),s.setAttribute("stroke","#66ccff"),s.setAttribute("stroke-width","3"),s.setAttribute("pointer-events","none"),r.appendChild(s)}function $e(r,t){for(const e of t){const i=ye(e);if(!i)continue;const n=parseFloat(i.getAttribute("cx")||"0"),c=parseFloat(i.getAttribute("cy")||"0"),s=parseFloat(i.getAttribute("r")||"0"),f=document.createElementNS(se,"circle");f.setAttribute("cx",String(n)),f.setAttribute("cy",String(c)),f.setAttribute("r",String(s+10)),f.setAttribute("fill","none"),f.setAttribute("stroke","#00e676"),f.setAttribute("stroke-width","3"),f.setAttribute("stroke-dasharray","4 3"),r.appendChild(f)}}function Se(r){const t=/^r(\d+)c(\d+)$/.exec(r);if(!t)throw new Error(`Invalid node id: ${r}`);const e=Number(t[1]),i=Number(t[2]);if(!Number.isInteger(e)||!Number.isInteger(i))throw new Error(`Invalid node coordinates in id: ${r}`);return{r:e,c:i}}function ee(r,t){return`r${r}c${t}`}function Z(r,t){return r>=0&&r<=6&&t>=0&&t<=6}function ne(r,t){return Z(r,t)&&(r+t)%2===0}function Re(r){const t=[],e=n=>!r.board.has(n)||(r.board.get(n)??[]).length===0,i=n=>{const c=r.board.get(n);return!c||c.length===0?!1:c[c.length-1].owner!==r.toMove};for(const[n,c]of r.board.entries()){if(!c||c.length===0)continue;const s=c[c.length-1];if(s.owner!==r.toMove)continue;const{r:f,c:u}=Se(n);let l=[];if(s.rank==="S"){const o=s.owner==="B"?2:-2;l=[{dr:o,dc:-2},{dr:o,dc:2}]}else l=[{dr:-2,dc:-2},{dr:-2,dc:2},{dr:2,dc:-2},{dr:2,dc:2}];for(const{dr:o,dc:a}of l){const h=f+o/2,m=u+a/2,w=f+o,g=u+a;if(!Z(h,m)||!Z(w,g)||!ne(w,g))continue;const d=ee(h,m),p=ee(w,g);i(d)&&e(p)&&t.push({kind:"capture",from:n,over:d,to:p})}}return t}function Pe(r){const t=Re(r);if(t.length>0)return t;const e=[],i=n=>!r.board.has(n)||(r.board.get(n)??[]).length===0;for(const[n,c]of r.board.entries()){if(!c||c.length===0)continue;const s=c[c.length-1];if(s.owner!==r.toMove)continue;const{r:f,c:u}=Se(n),l=[];if(s.rank==="S"){const o=s.owner==="B"?1:-1;for(const a of[-1,1]){const h=f+o,m=u+a;if(Z(h,m)&&ne(h,m)){const w=ee(h,m);i(w)&&l.push(w)}}}else{const o=[{dr:-1,dc:-1},{dr:-1,dc:1},{dr:1,dc:-1},{dr:1,dc:1}];for(const{dr:a,dc:h}of o){const m=f+a,w=u+h;if(Z(m,w)&&ne(m,w)){const g=ee(m,w);i(g)&&l.push(g)}}}for(const o of l)e.push({from:n,to:o,kind:"move"})}return e}function Ye(r,t){if(t.kind==="capture"){const c=r.toMove==="B"?"W":"B";return{board:new Map(r.board),toMove:c,phase:"idle"}}const e=new Map(r.board),i=e.get(t.from);if(!i||i.length===0)return r;e.set(t.to,i),e.delete(t.from);const n=r.toMove==="B"?"W":"B";return{board:e,toMove:n,phase:"idle"}}class Xe{constructor(t,e,i,n){this.selected=null,this.currentTargets=[],this.currentMoves=[],this.mandatoryCapture=!1,this.bannerTimer=null,this.svg=t,this.piecesLayer=e,this.inspector=i,this.overlayLayer=we(t),this.state=n}bind(){this.svg.addEventListener("click",t=>this.onClick(t))}setState(t){this.state=t,this.updatePanel()}updatePanel(){const t=document.getElementById("statusTurn"),e=document.getElementById("statusPhase"),i=document.getElementById("statusMessage");t&&(t.textContent=this.state.toMove==="B"?"Black":"White"),e&&(e.textContent=this.selected?"Select":"Idle"),i&&(this.selected?this.currentTargets.length>0?i.textContent="Choose a destination":this.mandatoryCapture?i.textContent="Capture required — select a capturing stack":i.textContent="No moves":i.textContent="—")}resolveClickedNode(t){if(t&&t instanceof Element){const e=t.closest("[data-node]");if(e){const n=e.getAttribute("data-node");if(n)return n}const i=t.closest("g.stack");if(i){const n=i.getAttribute("data-node");if(n)return n}if(t instanceof SVGCircleElement){const n=t.getAttribute("id");if(n)return n}}return null}svgPointFromClient(t){const e=this.svg.createSVGPoint?this.svg.createSVGPoint():null;if(e&&this.svg.getScreenCTM){e.x=t.clientX,e.y=t.clientY;const n=this.svg.getScreenCTM();if(n&&n.inverse){const c=e.matrixTransform(n.inverse());return{x:c.x,y:c.y}}}const i=this.svg.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}hitTestTargets(t){if(!this.selected||this.currentTargets.length===0)return null;const{x:e,y:i}=this.svgPointFromClient(t);for(const n of this.currentTargets){const c=document.getElementById(n);if(!c)continue;const s=parseFloat(c.getAttribute("cx")||"0"),f=parseFloat(c.getAttribute("cy")||"0"),u=parseFloat(c.getAttribute("r")||"0"),l=e-s,o=i-f;if(Math.sqrt(l*l+o*o)<=u+12)return n}return null}isOwnStack(t){const e=this.state.board.get(t);return!e||e.length===0?!1:e[e.length-1].owner===this.state.toMove}showSelection(t){pe(this.overlayLayer),Ge(this.overlayLayer,t);const e=Pe(this.state);this.mandatoryCapture=e.length>0&&e[0].kind==="capture",this.currentMoves=e.filter(i=>i.from===t),this.currentTargets=this.currentMoves.map(i=>i.to),$e(this.overlayLayer,this.currentTargets),this.updatePanel()}clearSelection(){this.selected=null,this.currentTargets=[],this.currentMoves=[],this.mandatoryCapture=!1,pe(this.overlayLayer),this.updatePanel()}showBanner(t,e=1500){const i=document.getElementById("statusMessage");i&&(i.textContent=t),this.bannerTimer&&window.clearTimeout(this.bannerTimer),this.bannerTimer=window.setTimeout(()=>{this.bannerTimer=null,this.updatePanel()},e)}onClick(t){let e=this.resolveClickedNode(t.target);if(e||(e=this.hitTestTargets(t)),!e){this.clearSelection();return}if(this.selected&&this.currentTargets.includes(e)){const i=this.currentMoves.find(c=>c.to===e&&c.from===this.selected);if(!i){this.clearSelection();return}const n=Ye(this.state,i);this.state=n,ge(this.svg,this.piecesLayer,this.inspector,this.state),this.clearSelection(),i.kind==="capture"&&this.showBanner("Turn changed");return}this.isOwnStack(e)?(this.selected=e,this.showSelection(e)):this.clearSelection()}}window.addEventListener("DOMContentLoaded",async()=>{const r=document.getElementById("boardWrap");if(!r)throw new Error("Missing board container: #boardWrap");const t=new URL(""+new URL("lasca_board-C7LnMF4x.svg",import.meta.url).href,import.meta.url),e=await Me(r,t),i=document.getElementById("zoomTitle"),n=document.getElementById("zoomHint"),c=document.getElementById("zoomBody");if(!c)throw new Error("Missing inspector container: #zoomBody");const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.id="zoomSvg",s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("viewBox","0 0 120 200"),s.setAttribute("role","img"),s.setAttribute("aria-label","Stack column"),c.replaceChildren(s),Te();const f=document.getElementById("themeDropdown");await Fe(e).bindThemeDropdown(f);const l=e.querySelector("#pieces");if(!l)throw new Error("Missing SVG group inside board: #pieces");if(!i||!n)throw new Error("Missing inspector DOM nodes (zoomTitle/zoomHint)");const o=Ne(i,n,s),a=Ce(),h=document.getElementById("statusTurn"),m=document.getElementById("statusPhase"),w=document.getElementById("statusMessage");h&&(h.textContent=a.toMove==="B"?"Black":"White"),m&&(m.textContent=a.phase.charAt(0).toUpperCase()+a.phase.slice(1)),w&&(w.textContent="—"),ge(e,l,o,a),we(e),new Xe(e,l,o,a).bind()});
