(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const s of o.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&n(s)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerPolicy&&(o.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?o.credentials="include":i.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function n(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}})();const Le=["r0c0","r0c2","r0c4","r0c6","r1c1","r1c3","r1c5","r2c0","r2c2","r2c4","r2c6"],Be=["r4c0","r4c2","r4c4","r4c6","r5c1","r5c3","r5c5","r6c0","r6c2","r6c4","r6c6"];function pe(){const r=new Map;for(const t of Le)r.set(t,[{owner:"B",rank:"S"}]);for(const t of Be)r.set(t,[{owner:"W",rank:"S"}]);return{board:r,toMove:"W",phase:"select"}}function de(r){return r.owner==="W"&&r.rank==="S"?"#W_S":r.owner==="W"&&r.rank==="O"?"#W_O":r.owner==="B"&&r.rank==="S"?"#B_S":"#B_O"}const Ee="http://www.w3.org/2000/svg",Ie="http://www.w3.org/1999/xlink";function ue(r,t,e,n){const i=document.createElementNS(Ee,"use");return i.setAttribute("href",r),i.setAttributeNS(Ie,"xlink:href",r),i.setAttribute("width",String(n)),i.setAttribute("height",String(n)),i.setAttribute("x",String(t)),i.setAttribute("y",String(e)),i}const Z=6,he=Math.floor(Z/2),xe=Z-he,R="http://www.w3.org/2000/svg";function Me(r,t,e,n,i,o={}){const{pieceSize:s=86,maxShown:u=Z,keepTop:d=xe,keepBottom:l=he,miniSize:c=18,miniGap:h=3,spineGap:p=10,spinePad:y=6,crackGap:w=12}=o,m=i.length;if(m<=1)return;let a=[],f=!1;if(m<=u)a=i.slice();else{f=!0;const F=i.slice(0,l),W=i.slice(m-d);a=F.concat(W)}const k=a.length,T=k*c+(k-1)*h+(f?w:0),B=c+y*2,x=T+y*2,S=e+s/2+p,C=n-x/2,A=document.createElementNS(R,"rect");A.setAttribute("x",String(S)),A.setAttribute("y",String(C)),A.setAttribute("width",String(B)),A.setAttribute("height",String(x)),A.setAttribute("rx","10"),A.setAttribute("fill","rgba(0,0,0,0.28)"),A.setAttribute("stroke","rgba(255,255,255,0.35)"),A.setAttribute("stroke-width","1.4"),A.setAttribute("pointer-events","none"),t.appendChild(A);const O=r.querySelector("defs");if(!O)throw new Error("SVG <defs> not found. miniSpine requires <defs>.");const M=`clip_${Math.random().toString(16).slice(2)}`,v=document.createElementNS(R,"clipPath");v.setAttribute("id",M);const b=document.createElementNS(R,"rect");b.setAttribute("x",String(S+1)),b.setAttribute("y",String(C+1)),b.setAttribute("width",String(B-2)),b.setAttribute("height",String(x-2)),b.setAttribute("rx","9"),v.appendChild(b),O.appendChild(v);const L=document.createElementNS(R,"g");L.setAttribute("clip-path",`url(#${M})`),L.setAttribute("pointer-events","none");const G=S+y,g=C+x-y,E=l-1;for(let F=0;F<k;F++){const W=a[F],U=de(W);let J=F*(c+h);f&&F>E&&(J+=w);const q=g-c-J,V=G;L.appendChild(ue(U,V,q,c))}if(t.appendChild(L),f){const W=g-c-E*(c+h)-h-w/2,U=S+3,J=S+B-3,q=(U+J)/2,V=[`M ${U} ${W-5}`,`L ${q-6} ${W+2}`,`L ${q} ${W-3}`,`L ${q+6} ${W+4}`,`L ${J} ${W-1}`].join(" "),$=document.createElementNS(R,"path");$.setAttribute("d",V),$.setAttribute("fill","none"),$.setAttribute("stroke","rgba(0,0,0,0.45)"),$.setAttribute("stroke-width","4.0"),$.setAttribute("stroke-linecap","round"),$.setAttribute("stroke-linejoin","round"),$.setAttribute("pointer-events","none");const P=document.createElementNS(R,"path");P.setAttribute("d",V),P.setAttribute("fill","none"),P.setAttribute("stroke","rgba(255,255,255,0.75)"),P.setAttribute("stroke-width","2.2"),P.setAttribute("stroke-linecap","round"),P.setAttribute("stroke-linejoin","round"),P.setAttribute("pointer-events","none"),t.appendChild($),t.appendChild(P)}const N=S+B/2,j=C-12,D=document.createElementNS(R,"circle");D.setAttribute("cx",String(N)),D.setAttribute("cy",String(j)),D.setAttribute("r","10"),D.setAttribute("fill","rgba(0,0,0,0.78)"),D.setAttribute("stroke","rgba(255,255,255,0.65)"),D.setAttribute("stroke-width","1.4"),D.setAttribute("pointer-events","none");const I=document.createElementNS(R,"text");I.setAttribute("x",String(N)),I.setAttribute("y",String(j+.5)),I.setAttribute("text-anchor","middle"),I.setAttribute("dominant-baseline","middle"),I.setAttribute("fill","#fff"),I.setAttribute("font-size","12"),I.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),I.textContent=String(m),I.setAttribute("pointer-events","none"),t.appendChild(D),t.appendChild(I)}function Ne(r,t,e,n,i,o={}){const{pieceSize:s=86}=o,u=document.getElementById(n);if(!u||!i.length)return;const d=parseFloat(u.getAttribute("cx")||"0"),l=parseFloat(u.getAttribute("cy")||"0"),c=document.createElementNS("http://www.w3.org/2000/svg","g");c.setAttribute("data-node",n),c.setAttribute("class","stack");const h=i[i.length-1],p=s/2;c.appendChild(ue(de(h),d-p,l-p,s)),Me(r,c,d,l,i,{pieceSize:s,miniSize:18}),e&&i.length>1&&(c.style.cursor="pointer",c.addEventListener("pointerenter",()=>{e.cancelHide(),e.show(n,i)}),c.addEventListener("pointerleave",()=>{e.hideSoon()})),t.appendChild(c)}function X(r,t,e,n){t.textContent="";for(const[i,o]of n.board.entries())Ne(r,t,e,i,o)}const K="http://www.w3.org/2000/svg";function Te(r,t,e){let n=null;function i(){for(;e.firstChild;)e.removeChild(e.firstChild);e.setAttribute("viewBox","0 0 120 200"),e.removeAttribute("height")}function o(d,l){const c=l.length;for(r.textContent=`Stack @ ${d} (×${c})`,t.textContent=c>Z?"Full column order (bottom → top). Brackets mark pieces omitted in the mini preview spine.":"Full column order (bottom → top).";e.firstChild;)e.removeChild(e.firstChild);const h=22,p=4,y=26,w=24,m=120,a=c*h+(c-1)*p,f=y+a+w;e.setAttribute("viewBox",`0 0 ${m} ${f}`),e.setAttribute("height",String(f));const k=m/2-h/2,T=y,B=document.createElementNS(K,"rect");B.setAttribute("x",String(k-8)),B.setAttribute("y",String(T-10)),B.setAttribute("width",String(h+16)),B.setAttribute("height",String(a+20)),B.setAttribute("rx","12"),B.setAttribute("fill","rgba(0,0,0,0.28)"),B.setAttribute("stroke","rgba(255,255,255,0.18)"),B.setAttribute("stroke-width","1.4"),e.appendChild(B);const x=document.createElementNS(K,"text");x.setAttribute("x",String(m/2)),x.setAttribute("y",String(T-12)),x.setAttribute("text-anchor","middle"),x.setAttribute("fill","rgba(255,255,255,0.85)"),x.setAttribute("font-size","12"),x.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),x.textContent="TOP",e.appendChild(x);const S=document.createElementNS(K,"text");S.setAttribute("x",String(m/2)),S.setAttribute("y",String(T+a+18)),S.setAttribute("text-anchor","middle"),S.setAttribute("fill","rgba(255,255,255,0.85)"),S.setAttribute("font-size","12"),S.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),S.textContent="BOTTOM",e.appendChild(S);for(let C=0;C<c;C++){const A=l[C],O=de(A),M=T+(c-1-C)*(h+p);e.appendChild(ue(O,k,M,h))}if(c>Z){const C=he,A=xe,O=C,M=c-A-1;if(M>=O){const v=T+(c-1-M)*(h+p),b=T+(c-1-O)*(h+p)+h,L=k-18,G=k+h+18,g=10,E=document.createElementNS(K,"path");E.setAttribute("d",`M ${L+g} ${v} L ${L} ${v} L ${L} ${b} L ${L+g} ${b}`),E.setAttribute("fill","none"),E.setAttribute("stroke","rgba(255,255,255,0.90)"),E.setAttribute("stroke-width","2.2"),E.setAttribute("stroke-linecap","round"),E.setAttribute("stroke-linejoin","round"),e.appendChild(E);const N=document.createElementNS(K,"path");N.setAttribute("d",`M ${G-g} ${v} L ${G} ${v} L ${G} ${b} L ${G-g} ${b}`),N.setAttribute("fill","none"),N.setAttribute("stroke","rgba(255,255,255,0.90)"),N.setAttribute("stroke-width","2.2"),N.setAttribute("stroke-linecap","round"),N.setAttribute("stroke-linejoin","round"),e.appendChild(N)}}}function s(){n&&clearTimeout(n),n=null}function u(){n&&clearTimeout(n),n=setTimeout(()=>{r.textContent="Lasca Stack Inspector",t.textContent="Hover a stacked piece to see the full column order (bottom → top). If a crack appears on the mini spine, brackets mark the omitted middle here.",i()},80)}return{show:o,hideSoon:u,cancelHide:s,clearZoom:i}}const _="lasca.layout.",Q=22,ee={leftWidth:280,rightWidth:320,leftCollapsed:!1,rightCollapsed:!1};function Y(r,t,e){return Math.max(t,Math.min(e,r))}function ge(r,t){const e=localStorage.getItem(r);if(e==null)return t;const n=Number(e);return Number.isFinite(n)?n:t}function ye(r,t){const e=localStorage.getItem(r);return e==null?t:e==="1"}function be(r,t){localStorage.setItem(r,String(Math.round(t)))}function we(r,t){localStorage.setItem(r,t?"1":"0")}function Oe(r={}){const t=r.root??document.getElementById("appRoot"),e=r.left??document.getElementById("leftSidebar"),n=r.right??document.getElementById("rightSidebar"),i=r.gutterLeft??document.getElementById("gutterLeft"),o=r.gutterRight??document.getElementById("gutterRight");if(!t||!e||!n||!i||!o)throw new Error("splitLayout: missing root/sidebars/gutters");const s=t.querySelector('[data-action="collapse-left"]'),u=t.querySelector('[data-action="collapse-right"]'),d=t.querySelector('[data-action="expand-left"]'),l=t.querySelector('[data-action="expand-right"]'),c=420,h=200,p=520,y=240,w=560;let m=ge(_+"leftWidth",ee.leftWidth),a=ge(_+"rightWidth",ee.rightWidth),f=ye(_+"leftCollapsed",ee.leftCollapsed),k=ye(_+"rightCollapsed",ee.rightCollapsed),T=m,B=a;function x(){return t.getBoundingClientRect().width}function S(){return i.getBoundingClientRect().width+o.getBoundingClientRect().width}function C(){e.style.width=f?`${Q}px`:`${m}px`,n.style.width=k?`${Q}px`:`${a}px`,e.classList.toggle("collapsed",f),n.classList.toggle("collapsed",k),i.classList.toggle("disabled",f),o.classList.toggle("disabled",k),be(_+"leftWidth",m),be(_+"rightWidth",a),we(_+"leftCollapsed",f),we(_+"rightCollapsed",k)}function A(){const g=x(),E=k?Q:a;return g-S()-E-c}function O(){const g=x(),E=f?Q:m;return g-S()-E-c}function M(g){f!==g&&(g?T=m:m=Y(T,h,Math.min(p,A())),f=g,C())}function v(g){k!==g&&(g?B=a:a=Y(B,y,Math.min(w,O())),k=g,C())}function b(){f||(m=Y(m,h,Math.min(p,A()))),k||(a=Y(a,y,Math.min(w,O()))),C()}function L(g){if(f)return;const E=g.clientX,N=m,j=Math.min(p,A()),D=h;function I(W){const U=W.clientX-E;m=Y(N+U,D,j),C()}function F(){window.removeEventListener("pointermove",I),window.removeEventListener("pointerup",F);try{i.releasePointerCapture(g.pointerId)}catch{}}i.setPointerCapture(g.pointerId),window.addEventListener("pointermove",I),window.addEventListener("pointerup",F)}function G(g){if(k)return;const E=g.clientX,N=a,j=Math.min(w,O()),D=y;function I(W){const U=W.clientX-E;a=Y(N-U,D,j),C()}function F(){window.removeEventListener("pointermove",I),window.removeEventListener("pointerup",F);try{o.releasePointerCapture(g.pointerId)}catch{}}o.setPointerCapture(g.pointerId),window.addEventListener("pointermove",I),window.addEventListener("pointerup",F)}return i.addEventListener("pointerdown",L),o.addEventListener("pointerdown",G),i.addEventListener("dblclick",()=>M(!f)),o.addEventListener("dblclick",()=>v(!k)),s==null||s.addEventListener("click",()=>M(!0)),d==null||d.addEventListener("click",()=>M(!1)),u==null||u.addEventListener("click",()=>v(!0)),l==null||l.addEventListener("click",()=>v(!1)),b(),window.addEventListener("resize",b),{getState:()=>({leftWidth:m,rightWidth:a,leftCollapsed:f,rightCollapsed:k}),setLeftCollapsed:M,setRightCollapsed:v,setLeftWidth:g=>{m=g,b()},setRightWidth:g=>{a=g,b()}}}async function Ge(r,t){if(!r)throw new Error("loadSvgFileInto: containerEl is required");const e=await fetch(t);if(!e.ok)throw new Error(`loadSvgFileInto: failed to fetch ${String(t)} (${e.status})`);const n=await e.text(),o=new DOMParser().parseFromString(n,"image/svg+xml").documentElement;if(!o||o.nodeName.toLowerCase()!=="svg")throw new Error(`loadSvgFileInto: ${String(t)} did not parse as an <svg> root`);const s=document.importNode(o,!0);return r.replaceChildren(s),s}async function Fe(r,t){if(!r)throw new Error("loadSvgDefsInto: targetEl is required");if(!(!Array.isArray(t)||t.length===0))for(const e of t){const n=await fetch(e);if(!n.ok)throw new Error(`loadSvgDefsInto: failed to fetch ${String(e)} (${n.status})`);const i=await n.text(),o=new DOMParser().parseFromString(i,"image/svg+xml"),s=o.querySelector("defs"),u=s?Array.from(s.children):Array.from(o.documentElement.children);for(const d of u)r.appendChild(document.importNode(d,!0))}}const se="classic",ae=[{id:"classic",label:"Classic",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20PIECE%20SYMBOLS%20(W_S,%20B_S,%20W_O,%20B_O)%20========%20--%3e%3cradialGradient%20id='gradWhite'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ffffff'/%3e%3cstop%20offset='55%25'%20stop-color='%23f1f1f1'/%3e%3cstop%20offset='100%25'%20stop-color='%23d6d6d6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradBlack'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23444444'/%3e%3cstop%20offset='55%25'%20stop-color='%231c1c1c'/%3e%3cstop%20offset='100%25'%20stop-color='%23050505'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradGreen'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%237be58a'/%3e%3cstop%20offset='55%25'%20stop-color='%231fb34a'/%3e%3cstop%20offset='100%25'%20stop-color='%230a6f2a'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradRed'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ff8f8f'/%3e%3cstop%20offset='55%25'%20stop-color='%23e12a2a'/%3e%3cstop%20offset='100%25'%20stop-color='%238f1111'/%3e%3c/radialGradient%3e%3cpath%20id='star5'%20d='%20M%2050%2030%20L%2056.5%2043.2%20L%2071.0%2045.3%20L%2060.5%2055.6%20L%2063.0%2070.0%20L%2050.0%2063.2%20L%2037.0%2070.0%20L%2039.5%2055.6%20L%2029.0%2045.3%20L%2043.5%2043.2%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradWhite)'%20stroke='%23111'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.28'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradBlack)'%20stroke='%23f5f5f5'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.16'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.10'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradGreen)'%20stroke='%230b2a12'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.18'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradRed)'%20stroke='%233a0b0b'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.16'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvY2xhc3NpYy90aGVtZS5jc3MgKi8KOnJvb3R7CiAgLS1wYWdlLWJnOiAjMWIxYjFiOwogIC0tcGFuZWwtYmc6IHJnYmEoMjU1LDI1NSwyNTUsMC4wNik7CiAgLS1wYW5lbC1ib3JkZXI6IHJnYmEoMjU1LDI1NSwyNTUsMC4xMCk7CiAgLS1wYW5lbC10ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuOTApOwogIC0tcGFuZWwtc3VidGV4dDogcmdiYSgyNTUsMjU1LDI1NSwwLjcwKTsKfQoKLyogU2xpZ2h0bHkgd2FybSBib2FyZCBjb25uZWN0b3JzL25vZGVzICovCiNsYXNjYUJvYXJkICNjb25uZWN0b3JzeyBzdHJva2U6ICMxMTE7IH0KI2xhc2NhQm9hcmQgI25vZGVzeyBzdHJva2U6ICMxMTE7IH0K",import.meta.url)},{id:"highContrast",label:"High Contrast",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20High-contrast%20flat%20pieces:%20same%20IDs%20(%23W_S,%20%23B_S,%20%23W_O,%20%23B_O)%20--%3e%3cpath%20id='star5'%20d='%20M%2050%2025%20L%2058%2042%20L%2077%2045%20L%2063%2058%20L%2066%2077%20L%2050%2068%20L%2034%2077%20L%2037%2058%20L%2023%2045%20L%2042%2042%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ffffff'%20stroke='%23000000'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23000000'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23000'%20opacity='0.06'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23000000'%20stroke='%23ffffff'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23ffffff'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.12'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%2321c75a'%20stroke='%23001a08'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ff2a2a'%20stroke='%231a0000'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvaGlnaENvbnRyYXN0L3RoZW1lLmNzcyAqLwo6cm9vdHsKICAtLXBhZ2UtYmc6ICMwYjBiMGI7CiAgLS1wYW5lbC1iZzogcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTsKICAtLXBhbmVsLWJvcmRlcjogcmdiYSgyNTUsMjU1LDI1NSwwLjE0KTsKICAtLXBhbmVsLXRleHQ6IHJnYmEoMjU1LDI1NSwyNTUsMC45NCk7CiAgLS1wYW5lbC1zdWJ0ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuNzgpOwp9CgovKiBNYWtlIGJvYXJkIGxpbmVzL3JpbmdzIG1vcmUgdmlzaWJsZSAqLwojbGFzY2FCb2FyZCAjY29ubmVjdG9yc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CiNsYXNjYUJvYXJkICNub2Rlc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CgovKiBCb29zdCBzcGluZSBidWJibGUgY29udHJhc3QgKi8KI2xhc2NhQm9hcmQgdGV4dHsgcGFpbnQtb3JkZXI6IHN0cm9rZTsgc3Ryb2tlOiByZ2JhKDAsMCwwLDAuNTUpOyBzdHJva2Utd2lkdGg6IDJweDsgfQo=",import.meta.url)}];function te(r){return ae.find(t=>t.id===r)??null}function We(r){const{rootEl:t,items:e,initialId:n,onSelect:i}=r??{};if(!t)throw new Error("createThemeDropdown: rootEl is required");if(!Array.isArray(e)||e.length===0)throw new Error("createThemeDropdown: items is required");const o=t.querySelector("#themeDropdownBtn"),s=t.querySelector("#themeDropdownMenu");if(!o||!s)throw new Error("createThemeDropdown: missing #themeDropdownBtn / #themeDropdownMenu");let u=!1,d=n??e[0].id;function l(a){u=a,o.setAttribute("aria-expanded",u?"true":"false"),u?(s.hidden=!1,s.focus({preventScroll:!0})):s.hidden=!0}function c(){const a=e.find(f=>f.id===d)??e[0];o.textContent=a?`${a.label} ▾`:"Theme ▾"}function h(){s.textContent="";for(const a of e){const f=document.createElement("button");f.type="button",f.className="themeOption",f.setAttribute("role","option"),f.setAttribute("data-id",a.id),f.setAttribute("aria-selected",a.id===d?"true":"false"),f.textContent=a.label,f.addEventListener("click",async()=>{await p(a.id),l(!1),o.focus({preventScroll:!0})}),s.appendChild(f)}}async function p(a){d=a,c(),h(),typeof i=="function"&&await i(a)}function y(a){if(!u)return;const f=a.target;f instanceof Node&&(t.contains(f)||l(!1))}function w(){l(!u)}function m(a){u&&a.key==="Escape"&&(a.preventDefault(),l(!1),o.focus({preventScroll:!0}))}return o.addEventListener("click",w),document.addEventListener("pointerdown",y),s.addEventListener("keydown",m),o.setAttribute("aria-haspopup","listbox"),s.setAttribute("role","listbox"),s.tabIndex=-1,c(),h(),l(!1),{setSelected:async a=>p(a),getSelected:()=>d,open:()=>l(!0),close:()=>l(!1),destroy:()=>{o.removeEventListener("click",w),document.removeEventListener("pointerdown",y),s.removeEventListener("keydown",m)}}}const Ce="lasca.theme",ke="lascaThemeCss";function De(r){const t="http://www.w3.org/2000/svg";let e=r.querySelector("defs");e||(e=document.createElementNS(t,"defs"),e.setAttribute("id","lascaDefs"),r.insertBefore(e,r.firstChild));let n=r.querySelector("#lascaThemeDefs");n||(n=document.createElementNS(t,"g"),n.setAttribute("id","lascaThemeDefs"),e.appendChild(n));let i=r.querySelector("#lascaRuntimeDefs");return i||(i=document.createElementNS(t,"g"),i.setAttribute("id","lascaRuntimeDefs"),e.appendChild(i)),{defs:e,themeDefs:n,runtimeDefs:i}}function He(){let r=document.getElementById(ke);return r&&r.tagName.toLowerCase()!=="link"&&(r.remove(),r=null),r||(r=document.createElement("link"),r.id=ke,r.rel="stylesheet",document.head.appendChild(r)),r}function ve(){const r=localStorage.getItem(Ce);return r||null}function Ue(r){localStorage.setItem(Ce,r)}function $e(r){if(!r)throw new Error("createThemeManager: svgRoot is required");const{themeDefs:t}=De(r);let e=null,n=null;async function i(d){if(!d)return;const l=String(d);if(l===n)return;const c=He();await new Promise(h=>{const p=()=>{c.removeEventListener("load",p),c.removeEventListener("error",p),h()};c.addEventListener("load",p),c.addEventListener("error",p),c.href=l}),n=l}async function o(d){const l=te(d)??te(se);if(!l)throw new Error("No themes available.");if(e===l.id)return l;const c=r.style.visibility;return r.style.visibility="hidden",t.replaceChildren(),await Fe(t,[l.piecesDefs,l.boardDefs]),await i(l.css),e=l.id,Ue(e),r.style.visibility=c||"visible",l}async function s(d){if(!d)return;const l=ae.map(y=>({id:y.id,label:y.label})),c=ve(),h=c&&te(c)?c:se;await o(h),await We({rootEl:d,items:l,initialId:h,onSelect:async y=>{await o(y)}}).setSelected(h)}async function u(d){if(!d)return;d.textContent="";for(const h of ae){const p=document.createElement("option");p.value=h.id,p.textContent=h.label,d.appendChild(p)}const l=ve(),c=l&&te(l)?l:se;d.value=c,await o(c),d.addEventListener("change",async()=>{await o(d.value)})}return{setTheme:o,bindThemeDropdown:s,bindThemeSelect:u,getCurrentThemeId:()=>e}}const oe="http://www.w3.org/2000/svg";function Ae(r){const t=r.querySelector("#overlays");if(t)return t;const e=document.createElementNS(oe,"g");e.id="overlays",e.setAttribute("pointer-events","none");const n=r.querySelector("#pieces");return n&&n.parentNode?n.nextSibling?n.parentNode.insertBefore(e,n.nextSibling):n.parentNode.appendChild(e):r.appendChild(e),e}function re(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function fe(r){return document.getElementById(r)}function Pe(r,t){const e=fe(t);if(!e)return;const n=parseFloat(e.getAttribute("cx")||"0"),i=parseFloat(e.getAttribute("cy")||"0"),o=parseFloat(e.getAttribute("r")||"0"),s=document.createElementNS(oe,"circle");s.setAttribute("cx",String(n)),s.setAttribute("cy",String(i)),s.setAttribute("r",String(o+6)),s.setAttribute("fill","none"),s.setAttribute("stroke","#66ccff"),s.setAttribute("stroke-width","3"),s.setAttribute("pointer-events","none"),r.appendChild(s)}function Re(r,t){for(const e of t){const n=fe(e);if(!n)continue;const i=parseFloat(n.getAttribute("cx")||"0"),o=parseFloat(n.getAttribute("cy")||"0"),s=parseFloat(n.getAttribute("r")||"0"),u=document.createElementNS(oe,"circle");u.setAttribute("cx",String(i)),u.setAttribute("cy",String(o)),u.setAttribute("r",String(s+10)),u.setAttribute("fill","none"),u.setAttribute("stroke","#00e676"),u.setAttribute("stroke-width","3"),u.setAttribute("stroke-dasharray","4 3"),r.appendChild(u)}}function ce(r,t,e="#ff9f40",n=4){const i=fe(t);if(!i)return;const o=parseFloat(i.getAttribute("cx")||"0"),s=parseFloat(i.getAttribute("cy")||"0"),u=parseFloat(i.getAttribute("r")||"0"),d=document.createElementNS(oe,"circle");d.setAttribute("cx",String(o)),d.setAttribute("cy",String(s)),d.setAttribute("r",String(u+12)),d.setAttribute("fill","none"),d.setAttribute("stroke",e),d.setAttribute("stroke-width",String(n)),d.setAttribute("stroke-dasharray","6 4"),d.setAttribute("pointer-events","none"),r.appendChild(d)}function me(r){const t=/^r(\d+)c(\d+)$/.exec(r);if(!t)throw new Error(`Invalid node id: ${r}`);const e=Number(t[1]),n=Number(t[2]);if(!Number.isInteger(e)||!Number.isInteger(n))throw new Error(`Invalid node coordinates in id: ${r}`);return{r:e,c:n}}function ie(r,t){return`r${r}c${t}`}function z(r,t){return r>=0&&r<=6&&t>=0&&t<=6}function le(r,t){return z(r,t)&&(r+t)%2===0}function _e(r,t){const e=[],n=o=>!r.board.has(o)||(r.board.get(o)??[]).length===0,i=o=>{const s=r.board.get(o);return!s||s.length===0?!1:s[s.length-1].owner!==r.toMove};for(const[o,s]of r.board.entries()){if(!s||s.length===0)continue;const u=s[s.length-1];if(u.owner!==r.toMove)continue;const{r:d,c:l}=me(o);let c=[];if(u.rank==="S"){const h=u.owner==="B"?2:-2;c=[{dr:h,dc:-2},{dr:h,dc:2}]}else c=[{dr:-2,dc:-2},{dr:-2,dc:2},{dr:2,dc:-2},{dr:2,dc:2}];for(const{dr:h,dc:p}of c){const y=d+h/2,w=l+p/2,m=d+h,a=l+p;if(!z(y,w)||!z(m,a)||!le(m,a))continue;const f=ie(y,w),k=ie(m,a);i(f)&&n(k)&&(t&&t.has(f)||e.push({kind:"capture",from:o,over:f,to:k}))}}return e}function H(r,t){const e=_e(r,t);if(e.length>0)return e;const n=[],i=o=>!r.board.has(o)||(r.board.get(o)??[]).length===0;for(const[o,s]of r.board.entries()){if(!s||s.length===0)continue;const u=s[s.length-1];if(u.owner!==r.toMove)continue;const{r:d,c:l}=me(o),c=[];if(u.rank==="S"){const h=u.owner==="B"?1:-1;for(const p of[-1,1]){const y=d+h,w=l+p;if(z(y,w)&&le(y,w)){const m=ie(y,w);i(m)&&c.push(m)}}}else{const h=[{dr:-1,dc:-1},{dr:-1,dc:1},{dr:1,dc:-1},{dr:1,dc:1}];for(const{dr:p,dc:y}of h){const w=d+p,m=l+y;if(z(w,m)&&le(w,m)){const a=ie(w,m);i(a)&&c.push(a)}}}for(const h of c)n.push({from:o,to:h,kind:"move"})}return n}function Se(r,t){const e=r.board.get(t);if(!e||e.length===0)return!1;const n=e[e.length-1];if(n.rank!=="S")return!1;const{r:i}=me(t);let o=!1;return(n.owner==="B"&&i===6||n.owner==="W"&&i===0)&&(o=!0),o?(n.rank="O",!0):!1}function je(r,t){if(t.kind==="capture"){const u=new Map(r.board),d=u.get(t.from);if(!d||d.length===0)throw new Error(`applyMove: no moving stack at ${t.from}`);const l=u.get(t.over);if(!l||l.length===0)throw new Error(`applyMove: no enemy stack to capture at ${t.over}`);const c=u.get(t.to);if(c&&c.length>0)throw new Error(`applyMove: landing square ${t.to} is not empty`);const h=l.pop();l.length===0?u.delete(t.over):u.set(t.over,l),u.set(t.to,d),d.unshift(h),u.delete(t.from);const p={...r,board:u},y=Se(p,t.to);return{board:u,toMove:r.toMove,phase:"idle",didPromote:y}}const e=new Map(r.board),n=e.get(t.from);if(!n||n.length===0)return r;e.set(t.to,n),e.delete(t.from);const i={...r,board:e},o=Se(i,t.to),s=r.toMove==="B"?"W":"B";return{board:e,toMove:s,phase:"idle",didPromote:o}}const Ye={stopCaptureOnPromotion:!0};function ne(r){const t=r.toMove,e=t==="B"?"W":"B";let n=!1;for(const o of r.board.values())if(o.length>0&&o[o.length-1].owner===t){n=!0;break}return n?H(r).length===0?{winner:e,reason:`${e==="B"?"Black":"White"} wins — ${t==="B"?"Black":"White"} has no moves`}:{winner:null,reason:null}:{winner:e,reason:`${e==="B"?"Black":"White"} wins — ${t==="B"?"Black":"White"} has no pieces`}}class Xe{constructor(t,e,n,i,o){this.selected=null,this.currentTargets=[],this.currentMoves=[],this.mandatoryCapture=!1,this.lockedCaptureFrom=null,this.jumpedSquares=new Set,this.isGameOver=!1,this.moveHintsEnabled=!1,this.bannerTimer=null,this.remainderTimer=null,this.onHistoryChange=null,this.svg=t,this.piecesLayer=e,this.inspector=n,this.overlayLayer=Ae(t),this.state=i,this.history=o}bind(){this.svg.addEventListener("click",e=>this.onClick(e));const t=H(this.state);this.mandatoryCapture=t.length>0&&t[0].kind==="capture",this.updatePanel()}setMoveHints(t){this.moveHintsEnabled=t,this.selected&&this.showSelection(this.selected)}setHistoryChangeCallback(t){this.onHistoryChange=t}undo(){if(this.isGameOver)return;const t=this.history.undo();if(t){this.state=t,this.lockedCaptureFrom=null,this.clearSelection(),X(this.svg,this.piecesLayer,this.inspector,this.state);const e=H(this.state);this.mandatoryCapture=e.length>0&&e[0].kind==="capture",this.updatePanel(),this.onHistoryChange&&this.onHistoryChange()}}redo(){if(this.isGameOver)return;const t=this.history.redo();if(t){this.state=t,this.lockedCaptureFrom=null,this.clearSelection(),X(this.svg,this.piecesLayer,this.inspector,this.state);const e=H(this.state);this.mandatoryCapture=e.length>0&&e[0].kind==="capture",this.updatePanel(),this.onHistoryChange&&this.onHistoryChange()}}canUndo(){return this.history.canUndo()}canRedo(){return this.history.canRedo()}getHistory(){return this.history.getHistory()}setState(t){this.state=t;const e=ne(this.state);if(e.winner){this.isGameOver=!0,this.showBanner(e.reason||"Game Over",0),this.updatePanel();return}this.isGameOver=!1;const n=H(this.state);this.mandatoryCapture=n.length>0&&n[0].kind==="capture",this.updatePanel()}getState(){return this.state}resign(){if(this.isGameOver)return;const e=(this.state.toMove==="B"?"W":"B")==="B"?"Black":"White",n=this.state.toMove==="B"?"Black":"White";this.isGameOver=!0,this.clearSelection(),this.showBanner(`${n} resigned — ${e} wins!`,0)}newGame(t){this.history.clear(),this.history.push(t),this.state=t,this.isGameOver=!1,this.clearSelection(),X(this.svg,this.piecesLayer,this.inspector,this.state);const e=H(this.state);this.mandatoryCapture=e.length>0&&e[0].kind==="capture",this.updatePanel(),this.onHistoryChange&&this.onHistoryChange()}updatePanel(){const t=document.getElementById("statusTurn"),e=document.getElementById("statusPhase"),n=document.getElementById("statusMessage");t&&(t.textContent=this.state.toMove==="B"?"Black":"White"),e&&(e.textContent=this.isGameOver?"Game Over":this.selected?"Select":"Idle"),n&&!this.isGameOver&&(this.selected?this.currentTargets.length>0?this.lockedCaptureFrom?n.textContent="Continue capturing":n.textContent="Choose a destination":this.mandatoryCapture?n.textContent="Capture required — select a capturing stack":n.textContent="No moves":this.mandatoryCapture?n.textContent="Capture available — you must capture":n.textContent="—")}resolveClickedNode(t){if(t&&t instanceof Element){const e=t.closest("[data-node]");if(e){const i=e.getAttribute("data-node");if(i)return i}const n=t.closest("g.stack");if(n){const i=n.getAttribute("data-node");if(i)return i}if(t instanceof SVGCircleElement){const i=t.getAttribute("id");if(i)return i}}return null}svgPointFromClient(t){const e=this.svg.createSVGPoint?this.svg.createSVGPoint():null;if(e&&this.svg.getScreenCTM){e.x=t.clientX,e.y=t.clientY;const i=this.svg.getScreenCTM();if(i&&i.inverse){const o=e.matrixTransform(i.inverse());return{x:o.x,y:o.y}}}const n=this.svg.getBoundingClientRect();return{x:t.clientX-n.left,y:t.clientY-n.top}}hitTestTargets(t){if(!this.selected||this.currentTargets.length===0)return null;const{x:e,y:n}=this.svgPointFromClient(t);for(const i of this.currentTargets){const o=document.getElementById(i);if(!o)continue;const s=parseFloat(o.getAttribute("cx")||"0"),u=parseFloat(o.getAttribute("cy")||"0"),d=parseFloat(o.getAttribute("r")||"0"),l=e-s,c=n-u;if(Math.sqrt(l*l+c*c)<=d+12)return i}return null}isOwnStack(t){const e=this.state.board.get(t);return!e||e.length===0?!1:e[e.length-1].owner===this.state.toMove}showSelection(t){re(this.overlayLayer),Pe(this.overlayLayer,t);const e=H(this.state,this.lockedCaptureFrom?this.jumpedSquares:void 0);this.mandatoryCapture=e.length>0&&e[0].kind==="capture";let n=e.filter(i=>i.from===t);if(this.lockedCaptureFrom&&this.lockedCaptureFrom!==t&&(n=[]),this.currentMoves=n,this.currentTargets=this.currentMoves.map(i=>i.to),Re(this.overlayLayer,this.currentTargets),this.moveHintsEnabled)for(const i of this.currentMoves)i.kind==="capture"&&(ce(this.overlayLayer,i.over,"#ff6b6b",3),ce(this.overlayLayer,i.to,"#ff9f40",4));this.updatePanel()}clearSelection(){this.selected=null,this.currentTargets=[],this.currentMoves=[],this.mandatoryCapture=!1,this.lockedCaptureFrom=null,this.jumpedSquares.clear(),re(this.overlayLayer),this.updatePanel()}showBanner(t,e=1500){const n=document.getElementById("statusMessage");n&&(n.textContent=t),this.bannerTimer&&window.clearTimeout(this.bannerTimer),e>0&&(this.bannerTimer=window.setTimeout(()=>{this.bannerTimer=null,this.updatePanel()},e))}showRemainderHint(t,e=1200){ce(this.overlayLayer,t,"#ff9f40",4),this.remainderTimer&&window.clearTimeout(this.remainderTimer),this.remainderTimer=window.setTimeout(()=>{this.remainderTimer=null,re(this.overlayLayer),this.updatePanel()},e)}onClick(t){if(this.isGameOver)return;let e=this.resolveClickedNode(t.target);if(e||(e=this.hitTestTargets(t)),!e){this.clearSelection();return}if(this.selected&&this.currentTargets.includes(e)){const n=this.currentMoves.find(o=>o.to===e&&o.from===this.selected);if(!n){this.clearSelection();return}const i=je(this.state,n);if(this.state=i,X(this.svg,this.piecesLayer,this.inspector,this.state),this.remainderTimer&&(window.clearTimeout(this.remainderTimer),this.remainderTimer=null),re(this.overlayLayer),n.kind==="capture"){this.jumpedSquares.add(n.over);const o=i.didPromote||!1,u=H(this.state,this.jumpedSquares).filter(c=>c.kind==="capture").filter(c=>c.from===n.to);if(o&&Ye.stopCaptureOnPromotion){this.state={...this.state,toMove:this.state.toMove==="B"?"W":"B"},this.lockedCaptureFrom=null,this.jumpedSquares.clear(),this.clearSelection(),this.history.push(this.state),this.onHistoryChange&&this.onHistoryChange();const c=H(this.state);this.mandatoryCapture=c.length>0&&c[0].kind==="capture";const h=ne(this.state);if(h.winner){this.isGameOver=!0,this.showBanner(h.reason||"Game Over",0);return}this.showBanner("Promoted — capture turn ends");return}if(u.length>0){this.lockedCaptureFrom=n.to,this.selected=n.to,this.showSelection(n.to),this.showBanner("Continue capture");return}this.state={...this.state,toMove:this.state.toMove==="B"?"W":"B"},this.lockedCaptureFrom=null,this.jumpedSquares.clear(),this.clearSelection(),this.history.push(this.state),this.onHistoryChange&&this.onHistoryChange();const d=H(this.state);this.mandatoryCapture=d.length>0&&d[0].kind==="capture";const l=ne(this.state);if(l.winner){this.isGameOver=!0,this.showBanner(l.reason||"Game Over",0);return}this.showBanner("Turn changed")}else{this.clearSelection(),this.history.push(this.state),this.onHistoryChange&&this.onHistoryChange();const o=H(this.state);this.mandatoryCapture=o.length>0&&o[0].kind==="capture";const s=ne(this.state);if(s.winner){this.isGameOver=!0,this.showBanner(s.reason||"Game Over",0);return}this.updatePanel()}return}if(this.lockedCaptureFrom){if(e===this.lockedCaptureFrom){this.selected=e,this.showSelection(e);return}return}this.isOwnStack(e)?(this.selected=e,this.showSelection(e)):this.clearSelection()}}function Je(r){return{board:Array.from(r.board.entries()),toMove:r.toMove,phase:r.phase}}function qe(r){return{board:new Map(r.board),toMove:r.toMove,phase:r.phase}}function Ke(r,t="lasca-game.json"){const e=Je(r),n=JSON.stringify(e,null,2),i=new Blob([n],{type:"application/json"}),o=URL.createObjectURL(i),s=document.createElement("a");s.href=o,s.download=t,document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(o)}function Ze(r){return new Promise((t,e)=>{const n=new FileReader;n.onload=i=>{var o;try{const s=(o=i.target)==null?void 0:o.result,u=JSON.parse(s),d=qe(u);t(d)}catch(s){e(new Error(`Failed to load game: ${s}`))}},n.onerror=()=>{e(new Error("Failed to read file"))},n.readAsText(r)})}class ze{constructor(){this.history=[],this.currentIndex=-1}push(t){this.history=this.history.slice(0,this.currentIndex+1),this.history.push(this.cloneState(t)),this.currentIndex=this.history.length-1}undo(){return this.canUndo()?(this.currentIndex--,this.cloneState(this.history[this.currentIndex])):null}redo(){return this.canRedo()?(this.currentIndex++,this.cloneState(this.history[this.currentIndex])):null}canUndo(){return this.currentIndex>0}canRedo(){return this.currentIndex<this.history.length-1}getCurrent(){return this.currentIndex<0||this.currentIndex>=this.history.length?null:this.cloneState(this.history[this.currentIndex])}getHistory(){return this.history.map((t,e)=>({index:e,toMove:t.toMove,isCurrent:e===this.currentIndex}))}size(){return this.history.length}getCurrentIndex(){return this.currentIndex}clear(){this.history=[],this.currentIndex=-1}cloneState(t){return{board:new Map(Array.from(t.board.entries()).map(([e,n])=>[e,n.map(i=>({...i}))])),toMove:t.toMove,phase:t.phase}}}window.addEventListener("DOMContentLoaded",async()=>{const r=document.getElementById("boardWrap");if(!r)throw new Error("Missing board container: #boardWrap");const t=new URL(""+new URL("lasca_board-C7LnMF4x.svg",import.meta.url).href,import.meta.url),e=await Ge(r,t),n=document.getElementById("zoomTitle"),i=document.getElementById("zoomHint"),o=document.getElementById("zoomBody");if(!o)throw new Error("Missing inspector container: #zoomBody");const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.id="zoomSvg",s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("viewBox","0 0 120 200"),s.setAttribute("role","img"),s.setAttribute("aria-label","Stack column"),o.replaceChildren(s),Oe();const u=document.getElementById("themeDropdown");await $e(e).bindThemeDropdown(u);const l=e.querySelector("#pieces");if(!l)throw new Error("Missing SVG group inside board: #pieces");if(!n||!i)throw new Error("Missing inspector DOM nodes (zoomTitle/zoomHint)");const c=Te(n,i,s),h=pe(),p=new ze;p.push(h);const y=document.getElementById("statusTurn"),w=document.getElementById("statusPhase"),m=document.getElementById("statusMessage");y&&(y.textContent=h.toMove==="B"?"Black":"White"),w&&(w.textContent=h.phase.charAt(0).toUpperCase()+h.phase.slice(1)),m&&(m.textContent="—"),X(e,l,c,h),Ae(e);const a=new Xe(e,l,c,h,p);a.bind();const f=document.getElementById("moveHintsToggle");f&&f.addEventListener("change",()=>{a.setMoveHints(f.checked)});const k=document.getElementById("newGameBtn");k&&k.addEventListener("click",()=>{if(confirm("Start a new game? This will clear the current game and undo history.")){const b=pe();a.newGame(b)}});const T=document.getElementById("saveGameBtn"),B=document.getElementById("loadGameBtn"),x=document.getElementById("loadGameInput");T&&T.addEventListener("click",()=>{const v=a.getState(),b=new Date().toISOString().replace(/:/g,"-").split(".")[0];Ke(v,`lasca-game-${b}.json`)}),B&&x&&(B.addEventListener("click",()=>{x.click()}),x.addEventListener("change",async()=>{var b;const v=(b=x.files)==null?void 0:b[0];if(v){try{const L=await Ze(v);a.setState(L),X(e,l,c,L);const G=document.getElementById("statusMessage");if(G){const g=G.textContent;G.textContent="Game loaded successfully",setTimeout(()=>{a.setState(L)},1500)}}catch(L){console.error("Failed to load game:",L),alert(`Failed to load game: ${L}`)}x.value=""}}));const S=document.getElementById("undoBtn"),C=document.getElementById("redoBtn"),A=document.getElementById("moveHistory"),O=()=>{if(S&&(S.disabled=!a.canUndo()),C&&(C.disabled=!a.canRedo()),A){const v=a.getHistory();v.length===0?A.textContent="No moves yet":A.innerHTML=v.map((b,L)=>{const G=Math.floor(L/2)+1,g=b.toMove==="B"?"Black":"White",E=L===0?"Start":`${G}. ${g==="Black"?"⚫":"⚪"}`;return`<div style="${b.isCurrent?"font-weight: bold; color: rgba(255, 255, 255, 0.95); background: rgba(255, 255, 255, 0.1); padding: 2px 6px; border-radius: 4px;":""}">${E}</div>`}).join("")}};S&&S.addEventListener("click",()=>{a.undo()}),C&&C.addEventListener("click",()=>{a.redo()});const M=document.getElementById("resignBtn");M&&M.addEventListener("click",()=>{const v=a.getState().toMove==="B"?"Black":"White";confirm(`Are you sure you want to resign as ${v}?`)&&a.resign()}),a.setHistoryChangeCallback(O),O()});
