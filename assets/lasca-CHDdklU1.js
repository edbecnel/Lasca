(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))c(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const o of n.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&c(o)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function c(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();const Se=["r0c0","r0c2","r0c4","r0c6","r1c1","r1c3","r1c5","r2c0","r2c2","r2c4","r2c6"],xe=["r4c0","r4c2","r4c4","r4c6","r5c1","r5c3","r5c5","r6c0","r6c2","r6c4","r6c6"],ke="r3c3",Ae=[{owner:"B",rank:"O"},{owner:"W",rank:"S"},{owner:"B",rank:"S"},{owner:"W",rank:"O"},{owner:"B",rank:"S"},{owner:"W",rank:"S"},{owner:"B",rank:"O"},{owner:"W",rank:"S"}];function ve(){const r=new Map;for(const t of Se)r.set(t,[{owner:"B",rank:"S"}]);for(const t of xe)r.set(t,[{owner:"W",rank:"S"}]);return r.set(ke,Ae),{board:r,toMove:"W",phase:"select"}}function re(r){return r.owner==="W"&&r.rank==="S"?"#W_S":r.owner==="W"&&r.rank==="O"?"#W_O":r.owner==="B"&&r.rank==="S"?"#B_S":"#B_O"}const Ce="http://www.w3.org/2000/svg",Le="http://www.w3.org/1999/xlink";function ie(r,t,e,c){const i=document.createElementNS(Ce,"use");return i.setAttribute("href",r),i.setAttributeNS(Le,"xlink:href",r),i.setAttribute("width",String(c)),i.setAttribute("height",String(c)),i.setAttribute("x",String(t)),i.setAttribute("y",String(e)),i}const J=6,ce=Math.floor(J/2),me=J-ce,R="http://www.w3.org/2000/svg";function Ee(r,t,e,c,i,n={}){const{pieceSize:o=86,maxShown:u=J,keepTop:f=me,keepBottom:l=ce,miniSize:s=18,miniGap:a=3,spineGap:h=10,spinePad:g=6,crackGap:y=12}=n,b=i.length;if(b<=1)return;let d=[],p=!1;if(b<=u)d=i.slice();else{p=!0;const N=i.slice(0,l),T=i.slice(b-f);d=N.concat(T)}const w=d.length,O=w*s+(w-1)*a+(p?y:0),A=s+g*2,C=O+g*2,S=e+o/2+h,v=c-C/2,x=document.createElementNS(R,"rect");x.setAttribute("x",String(S)),x.setAttribute("y",String(v)),x.setAttribute("width",String(A)),x.setAttribute("height",String(C)),x.setAttribute("rx","10"),x.setAttribute("fill","rgba(0,0,0,0.28)"),x.setAttribute("stroke","rgba(255,255,255,0.35)"),x.setAttribute("stroke-width","1.4"),x.setAttribute("pointer-events","none"),t.appendChild(x);const W=r.querySelector("defs");if(!W)throw new Error("SVG <defs> not found. miniSpine requires <defs>.");const M=`clip_${Math.random().toString(16).slice(2)}`,B=document.createElementNS(R,"clipPath");B.setAttribute("id",M);const L=document.createElementNS(R,"rect");L.setAttribute("x",String(S+1)),L.setAttribute("y",String(v+1)),L.setAttribute("width",String(A-2)),L.setAttribute("height",String(C-2)),L.setAttribute("rx","9"),B.appendChild(L),W.appendChild(B);const _=document.createElementNS(R,"g");_.setAttribute("clip-path",`url(#${M})`),_.setAttribute("pointer-events","none");const U=S+g,m=v+C-g,k=l-1;for(let N=0;N<w;N++){const T=d[N],F=re(T);let H=N*(s+a);p&&N>k&&(H+=y);const K=m-s-H,Z=U;_.appendChild(ie(F,Z,K,s))}if(t.appendChild(_),p){const T=m-s-k*(s+a)-a-y/2,F=S+3,H=S+A-3,K=(F+H)/2,Z=[`M ${F} ${T-5}`,`L ${K-6} ${T+2}`,`L ${K} ${T-3}`,`L ${K+6} ${T+4}`,`L ${H} ${T-1}`].join(" "),G=document.createElementNS(R,"path");G.setAttribute("d",Z),G.setAttribute("fill","none"),G.setAttribute("stroke","rgba(0,0,0,0.45)"),G.setAttribute("stroke-width","4.0"),G.setAttribute("stroke-linecap","round"),G.setAttribute("stroke-linejoin","round"),G.setAttribute("pointer-events","none");const $=document.createElementNS(R,"path");$.setAttribute("d",Z),$.setAttribute("fill","none"),$.setAttribute("stroke","rgba(255,255,255,0.75)"),$.setAttribute("stroke-width","2.2"),$.setAttribute("stroke-linecap","round"),$.setAttribute("stroke-linejoin","round"),$.setAttribute("pointer-events","none"),t.appendChild(G),t.appendChild($)}const I=S+A/2,P=v-12,D=document.createElementNS(R,"circle");D.setAttribute("cx",String(I)),D.setAttribute("cy",String(P)),D.setAttribute("r","10"),D.setAttribute("fill","rgba(0,0,0,0.78)"),D.setAttribute("stroke","rgba(255,255,255,0.65)"),D.setAttribute("stroke-width","1.4"),D.setAttribute("pointer-events","none");const E=document.createElementNS(R,"text");E.setAttribute("x",String(I)),E.setAttribute("y",String(P+.5)),E.setAttribute("text-anchor","middle"),E.setAttribute("dominant-baseline","middle"),E.setAttribute("fill","#fff"),E.setAttribute("font-size","12"),E.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),E.textContent=String(b),E.setAttribute("pointer-events","none"),t.appendChild(D),t.appendChild(E)}function Ie(r,t,e,c,i,n={}){const{pieceSize:o=86}=n,u=document.getElementById(c);if(!u||!i.length)return;const f=parseFloat(u.getAttribute("cx")||"0"),l=parseFloat(u.getAttribute("cy")||"0"),s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("data-node",c),s.setAttribute("class","stack");const a=i[i.length-1],h=o/2;s.appendChild(ie(re(a),f-h,l-h,o)),Ee(r,s,f,l,i,{pieceSize:o,miniSize:18}),e&&i.length>1&&(s.style.cursor="pointer",s.addEventListener("pointerenter",()=>{e.cancelHide(),e.show(c,i)}),s.addEventListener("pointerleave",()=>{e.hideSoon()})),t.appendChild(s)}function ge(r,t,e,c){t.textContent="";for(const[i,n]of c.board.entries())Ie(r,t,e,i,n)}const j="http://www.w3.org/2000/svg";function Ne(r,t,e){let c=null;function i(){for(;e.firstChild;)e.removeChild(e.firstChild);e.setAttribute("viewBox","0 0 120 200"),e.removeAttribute("height")}function n(f,l){const s=l.length;for(r.textContent=`Stack @ ${f} (×${s})`,t.textContent=s>J?"Full column order (bottom → top). Brackets mark pieces omitted in the mini preview spine.":"Full column order (bottom → top).";e.firstChild;)e.removeChild(e.firstChild);const a=22,h=4,g=26,y=24,b=120,d=s*a+(s-1)*h,p=g+d+y;e.setAttribute("viewBox",`0 0 ${b} ${p}`),e.setAttribute("height",String(p));const w=b/2-a/2,O=g,A=document.createElementNS(j,"rect");A.setAttribute("x",String(w-8)),A.setAttribute("y",String(O-10)),A.setAttribute("width",String(a+16)),A.setAttribute("height",String(d+20)),A.setAttribute("rx","12"),A.setAttribute("fill","rgba(0,0,0,0.28)"),A.setAttribute("stroke","rgba(255,255,255,0.18)"),A.setAttribute("stroke-width","1.4"),e.appendChild(A);const C=document.createElementNS(j,"text");C.setAttribute("x",String(b/2)),C.setAttribute("y",String(O-12)),C.setAttribute("text-anchor","middle"),C.setAttribute("fill","rgba(255,255,255,0.85)"),C.setAttribute("font-size","12"),C.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),C.textContent="TOP",e.appendChild(C);const S=document.createElementNS(j,"text");S.setAttribute("x",String(b/2)),S.setAttribute("y",String(O+d+18)),S.setAttribute("text-anchor","middle"),S.setAttribute("fill","rgba(255,255,255,0.85)"),S.setAttribute("font-size","12"),S.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),S.textContent="BOTTOM",e.appendChild(S);for(let v=0;v<s;v++){const x=l[v],W=re(x),M=O+(s-1-v)*(a+h);e.appendChild(ie(W,w,M,a))}if(s>J){const v=ce,x=me,W=v,M=s-x-1;if(M>=W){const B=O+(s-1-M)*(a+h),L=O+(s-1-W)*(a+h)+a,_=w-18,U=w+a+18,m=10,k=document.createElementNS(j,"path");k.setAttribute("d",`M ${_+m} ${B} L ${_} ${B} L ${_} ${L} L ${_+m} ${L}`),k.setAttribute("fill","none"),k.setAttribute("stroke","rgba(255,255,255,0.90)"),k.setAttribute("stroke-width","2.2"),k.setAttribute("stroke-linecap","round"),k.setAttribute("stroke-linejoin","round"),e.appendChild(k);const I=document.createElementNS(j,"path");I.setAttribute("d",`M ${U-m} ${B} L ${U} ${B} L ${U} ${L} L ${U-m} ${L}`),I.setAttribute("fill","none"),I.setAttribute("stroke","rgba(255,255,255,0.90)"),I.setAttribute("stroke-width","2.2"),I.setAttribute("stroke-linecap","round"),I.setAttribute("stroke-linejoin","round"),e.appendChild(I)}}}function o(){c&&clearTimeout(c),c=null}function u(){c&&clearTimeout(c),c=setTimeout(()=>{r.textContent="Lasca Stack Inspector",t.textContent="Hover a stacked piece to see the full column order (bottom → top). If a crack appears on the mini spine, brackets mark the omitted middle here.",i()},80)}return{show:n,hideSoon:u,cancelHide:o,clearZoom:i}}const Y="lasca.layout.",q=22,V={leftWidth:280,rightWidth:320,leftCollapsed:!1,rightCollapsed:!1};function X(r,t,e){return Math.max(t,Math.min(e,r))}function oe(r,t){const e=localStorage.getItem(r);if(e==null)return t;const c=Number(e);return Number.isFinite(c)?c:t}function se(r,t){const e=localStorage.getItem(r);return e==null?t:e==="1"}function le(r,t){localStorage.setItem(r,String(Math.round(t)))}function ae(r,t){localStorage.setItem(r,t?"1":"0")}function Be(r={}){const t=r.root??document.getElementById("appRoot"),e=r.left??document.getElementById("leftSidebar"),c=r.right??document.getElementById("rightSidebar"),i=r.gutterLeft??document.getElementById("gutterLeft"),n=r.gutterRight??document.getElementById("gutterRight");if(!t||!e||!c||!i||!n)throw new Error("splitLayout: missing root/sidebars/gutters");const o=t.querySelector('[data-action="collapse-left"]'),u=t.querySelector('[data-action="collapse-right"]'),f=t.querySelector('[data-action="expand-left"]'),l=t.querySelector('[data-action="expand-right"]'),s=420,a=200,h=520,g=240,y=560;let b=oe(Y+"leftWidth",V.leftWidth),d=oe(Y+"rightWidth",V.rightWidth),p=se(Y+"leftCollapsed",V.leftCollapsed),w=se(Y+"rightCollapsed",V.rightCollapsed),O=b,A=d;function C(){return t.getBoundingClientRect().width}function S(){return i.getBoundingClientRect().width+n.getBoundingClientRect().width}function v(){e.style.width=p?`${q}px`:`${b}px`,c.style.width=w?`${q}px`:`${d}px`,e.classList.toggle("collapsed",p),c.classList.toggle("collapsed",w),i.classList.toggle("disabled",p),n.classList.toggle("disabled",w),le(Y+"leftWidth",b),le(Y+"rightWidth",d),ae(Y+"leftCollapsed",p),ae(Y+"rightCollapsed",w)}function x(){const m=C(),k=w?q:d;return m-S()-k-s}function W(){const m=C(),k=p?q:b;return m-S()-k-s}function M(m){p!==m&&(m?O=b:b=X(O,a,Math.min(h,x())),p=m,v())}function B(m){w!==m&&(m?A=d:d=X(A,g,Math.min(y,W())),w=m,v())}function L(){p||(b=X(b,a,Math.min(h,x()))),w||(d=X(d,g,Math.min(y,W()))),v()}function _(m){if(p)return;const k=m.clientX,I=b,P=Math.min(h,x()),D=a;function E(T){const F=T.clientX-k;b=X(I+F,D,P),v()}function N(){window.removeEventListener("pointermove",E),window.removeEventListener("pointerup",N);try{i.releasePointerCapture(m.pointerId)}catch{}}i.setPointerCapture(m.pointerId),window.addEventListener("pointermove",E),window.addEventListener("pointerup",N)}function U(m){if(w)return;const k=m.clientX,I=d,P=Math.min(y,W()),D=g;function E(T){const F=T.clientX-k;d=X(I-F,D,P),v()}function N(){window.removeEventListener("pointermove",E),window.removeEventListener("pointerup",N);try{n.releasePointerCapture(m.pointerId)}catch{}}n.setPointerCapture(m.pointerId),window.addEventListener("pointermove",E),window.addEventListener("pointerup",N)}return i.addEventListener("pointerdown",_),n.addEventListener("pointerdown",U),i.addEventListener("dblclick",()=>M(!p)),n.addEventListener("dblclick",()=>B(!w)),o==null||o.addEventListener("click",()=>M(!0)),f==null||f.addEventListener("click",()=>M(!1)),u==null||u.addEventListener("click",()=>B(!0)),l==null||l.addEventListener("click",()=>B(!1)),L(),window.addEventListener("resize",L),{getState:()=>({leftWidth:b,rightWidth:d,leftCollapsed:p,rightCollapsed:w}),setLeftCollapsed:M,setRightCollapsed:B,setLeftWidth:m=>{b=m,L()},setRightWidth:m=>{d=m,L()}}}async function Te(r,t){if(!r)throw new Error("loadSvgFileInto: containerEl is required");const e=await fetch(t);if(!e.ok)throw new Error(`loadSvgFileInto: failed to fetch ${String(t)} (${e.status})`);const c=await e.text(),n=new DOMParser().parseFromString(c,"image/svg+xml").documentElement;if(!n||n.nodeName.toLowerCase()!=="svg")throw new Error(`loadSvgFileInto: ${String(t)} did not parse as an <svg> root`);const o=document.importNode(n,!0);return r.replaceChildren(o),o}async function Me(r,t){if(!r)throw new Error("loadSvgDefsInto: targetEl is required");if(!(!Array.isArray(t)||t.length===0))for(const e of t){const c=await fetch(e);if(!c.ok)throw new Error(`loadSvgDefsInto: failed to fetch ${String(e)} (${c.status})`);const i=await c.text(),n=new DOMParser().parseFromString(i,"image/svg+xml"),o=n.querySelector("defs"),u=o?Array.from(o.children):Array.from(n.documentElement.children);for(const f of u)r.appendChild(document.importNode(f,!0))}}const Q="classic",ee=[{id:"classic",label:"Classic",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20PIECE%20SYMBOLS%20(W_S,%20B_S,%20W_O,%20B_O)%20========%20--%3e%3cradialGradient%20id='gradWhite'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ffffff'/%3e%3cstop%20offset='55%25'%20stop-color='%23f1f1f1'/%3e%3cstop%20offset='100%25'%20stop-color='%23d6d6d6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradBlack'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23444444'/%3e%3cstop%20offset='55%25'%20stop-color='%231c1c1c'/%3e%3cstop%20offset='100%25'%20stop-color='%23050505'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradGreen'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%237be58a'/%3e%3cstop%20offset='55%25'%20stop-color='%231fb34a'/%3e%3cstop%20offset='100%25'%20stop-color='%230a6f2a'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradRed'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ff8f8f'/%3e%3cstop%20offset='55%25'%20stop-color='%23e12a2a'/%3e%3cstop%20offset='100%25'%20stop-color='%238f1111'/%3e%3c/radialGradient%3e%3cpath%20id='star5'%20d='%20M%2050%2030%20L%2056.5%2043.2%20L%2071.0%2045.3%20L%2060.5%2055.6%20L%2063.0%2070.0%20L%2050.0%2063.2%20L%2037.0%2070.0%20L%2039.5%2055.6%20L%2029.0%2045.3%20L%2043.5%2043.2%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradWhite)'%20stroke='%23111'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.28'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradBlack)'%20stroke='%23f5f5f5'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.16'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.10'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradGreen)'%20stroke='%230b2a12'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.18'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradRed)'%20stroke='%233a0b0b'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.16'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvY2xhc3NpYy90aGVtZS5jc3MgKi8KOnJvb3R7CiAgLS1wYWdlLWJnOiAjMWIxYjFiOwogIC0tcGFuZWwtYmc6IHJnYmEoMjU1LDI1NSwyNTUsMC4wNik7CiAgLS1wYW5lbC1ib3JkZXI6IHJnYmEoMjU1LDI1NSwyNTUsMC4xMCk7CiAgLS1wYW5lbC10ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuOTApOwogIC0tcGFuZWwtc3VidGV4dDogcmdiYSgyNTUsMjU1LDI1NSwwLjcwKTsKfQoKLyogU2xpZ2h0bHkgd2FybSBib2FyZCBjb25uZWN0b3JzL25vZGVzICovCiNsYXNjYUJvYXJkICNjb25uZWN0b3JzeyBzdHJva2U6ICMxMTE7IH0KI2xhc2NhQm9hcmQgI25vZGVzeyBzdHJva2U6ICMxMTE7IH0K",import.meta.url)},{id:"highContrast",label:"High Contrast",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20High-contrast%20flat%20pieces:%20same%20IDs%20(%23W_S,%20%23B_S,%20%23W_O,%20%23B_O)%20--%3e%3cpath%20id='star5'%20d='%20M%2050%2025%20L%2058%2042%20L%2077%2045%20L%2063%2058%20L%2066%2077%20L%2050%2068%20L%2034%2077%20L%2037%2058%20L%2023%2045%20L%2042%2042%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ffffff'%20stroke='%23000000'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23000000'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23000'%20opacity='0.06'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23000000'%20stroke='%23ffffff'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23ffffff'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.12'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%2321c75a'%20stroke='%23001a08'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ff2a2a'%20stroke='%231a0000'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvaGlnaENvbnRyYXN0L3RoZW1lLmNzcyAqLwo6cm9vdHsKICAtLXBhZ2UtYmc6ICMwYjBiMGI7CiAgLS1wYW5lbC1iZzogcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTsKICAtLXBhbmVsLWJvcmRlcjogcmdiYSgyNTUsMjU1LDI1NSwwLjE0KTsKICAtLXBhbmVsLXRleHQ6IHJnYmEoMjU1LDI1NSwyNTUsMC45NCk7CiAgLS1wYW5lbC1zdWJ0ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuNzgpOwp9CgovKiBNYWtlIGJvYXJkIGxpbmVzL3JpbmdzIG1vcmUgdmlzaWJsZSAqLwojbGFzY2FCb2FyZCAjY29ubmVjdG9yc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CiNsYXNjYUJvYXJkICNub2Rlc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CgovKiBCb29zdCBzcGluZSBidWJibGUgY29udHJhc3QgKi8KI2xhc2NhQm9hcmQgdGV4dHsgcGFpbnQtb3JkZXI6IHN0cm9rZTsgc3Ryb2tlOiByZ2JhKDAsMCwwLDAuNTUpOyBzdHJva2Utd2lkdGg6IDJweDsgfQo=",import.meta.url)}];function z(r){return ee.find(t=>t.id===r)??null}function De(r){const{rootEl:t,items:e,initialId:c,onSelect:i}=r??{};if(!t)throw new Error("createThemeDropdown: rootEl is required");if(!Array.isArray(e)||e.length===0)throw new Error("createThemeDropdown: items is required");const n=t.querySelector("#themeDropdownBtn"),o=t.querySelector("#themeDropdownMenu");if(!n||!o)throw new Error("createThemeDropdown: missing #themeDropdownBtn / #themeDropdownMenu");let u=!1,f=c??e[0].id;function l(d){u=d,n.setAttribute("aria-expanded",u?"true":"false"),u?(o.hidden=!1,o.focus({preventScroll:!0})):o.hidden=!0}function s(){const d=e.find(p=>p.id===f)??e[0];n.textContent=d?`${d.label} ▾`:"Theme ▾"}function a(){o.textContent="";for(const d of e){const p=document.createElement("button");p.type="button",p.className="themeOption",p.setAttribute("role","option"),p.setAttribute("data-id",d.id),p.setAttribute("aria-selected",d.id===f?"true":"false"),p.textContent=d.label,p.addEventListener("click",async()=>{await h(d.id),l(!1),n.focus({preventScroll:!0})}),o.appendChild(p)}}async function h(d){f=d,s(),a(),typeof i=="function"&&await i(d)}function g(d){if(!u)return;const p=d.target;p instanceof Node&&(t.contains(p)||l(!1))}function y(){l(!u)}function b(d){u&&d.key==="Escape"&&(d.preventDefault(),l(!1),n.focus({preventScroll:!0}))}return n.addEventListener("click",y),document.addEventListener("pointerdown",g),o.addEventListener("keydown",b),n.setAttribute("aria-haspopup","listbox"),o.setAttribute("role","listbox"),o.tabIndex=-1,s(),a(),l(!1),{setSelected:async d=>h(d),getSelected:()=>f,open:()=>l(!0),close:()=>l(!1),destroy:()=>{n.removeEventListener("click",y),document.removeEventListener("pointerdown",g),o.removeEventListener("keydown",b)}}}const be="lasca.theme",de="lascaThemeCss";function Oe(r){const t="http://www.w3.org/2000/svg";let e=r.querySelector("defs");e||(e=document.createElementNS(t,"defs"),e.setAttribute("id","lascaDefs"),r.insertBefore(e,r.firstChild));let c=r.querySelector("#lascaThemeDefs");c||(c=document.createElementNS(t,"g"),c.setAttribute("id","lascaThemeDefs"),e.appendChild(c));let i=r.querySelector("#lascaRuntimeDefs");return i||(i=document.createElementNS(t,"g"),i.setAttribute("id","lascaRuntimeDefs"),e.appendChild(i)),{defs:e,themeDefs:c,runtimeDefs:i}}function We(){let r=document.getElementById(de);return r&&r.tagName.toLowerCase()!=="link"&&(r.remove(),r=null),r||(r=document.createElement("link"),r.id=de,r.rel="stylesheet",document.head.appendChild(r)),r}function fe(){const r=localStorage.getItem(be);return r||null}function _e(r){localStorage.setItem(be,r)}function Ue(r){if(!r)throw new Error("createThemeManager: svgRoot is required");const{themeDefs:t}=Oe(r);let e=null,c=null;async function i(f){if(!f)return;const l=String(f);if(l===c)return;const s=We();await new Promise(a=>{const h=()=>{s.removeEventListener("load",h),s.removeEventListener("error",h),a()};s.addEventListener("load",h),s.addEventListener("error",h),s.href=l}),c=l}async function n(f){const l=z(f)??z(Q);if(!l)throw new Error("No themes available.");if(e===l.id)return l;const s=r.style.visibility;return r.style.visibility="hidden",t.replaceChildren(),await Me(t,[l.piecesDefs,l.boardDefs]),await i(l.css),e=l.id,_e(e),r.style.visibility=s||"visible",l}async function o(f){if(!f)return;const l=ee.map(g=>({id:g.id,label:g.label})),s=fe(),a=s&&z(s)?s:Q;await n(a),await De({rootEl:f,items:l,initialId:a,onSelect:async g=>{await n(g)}}).setSelected(a)}async function u(f){if(!f)return;f.textContent="";for(const a of ee){const h=document.createElement("option");h.value=a.id,h.textContent=a.label,f.appendChild(h)}const l=fe(),s=l&&z(l)?l:Q;f.value=s,await n(s),f.addEventListener("change",async()=>{await n(f.value)})}return{setTheme:n,bindThemeDropdown:o,bindThemeSelect:u,getCurrentThemeId:()=>e}}const ne="http://www.w3.org/2000/svg";function we(r){const t=r.querySelector("#overlays");if(t)return t;const e=document.createElementNS(ne,"g");e.id="overlays",e.setAttribute("pointer-events","none");const c=r.querySelector("#pieces");return c&&c.parentNode?c.nextSibling?c.parentNode.insertBefore(e,c.nextSibling):c.parentNode.appendChild(e):r.appendChild(e),e}function ue(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function ye(r){return document.getElementById(r)}function Fe(r,t){const e=ye(t);if(!e)return;const c=parseFloat(e.getAttribute("cx")||"0"),i=parseFloat(e.getAttribute("cy")||"0"),n=parseFloat(e.getAttribute("r")||"0"),o=document.createElementNS(ne,"circle");o.setAttribute("cx",String(c)),o.setAttribute("cy",String(i)),o.setAttribute("r",String(n+6)),o.setAttribute("fill","none"),o.setAttribute("stroke","#66ccff"),o.setAttribute("stroke-width","3"),o.setAttribute("pointer-events","none"),r.appendChild(o)}function Ge(r,t){for(const e of t){const c=ye(e);if(!c)continue;const i=parseFloat(c.getAttribute("cx")||"0"),n=parseFloat(c.getAttribute("cy")||"0"),o=parseFloat(c.getAttribute("r")||"0"),u=document.createElementNS(ne,"circle");u.setAttribute("cx",String(i)),u.setAttribute("cy",String(n)),u.setAttribute("r",String(o+10)),u.setAttribute("fill","none"),u.setAttribute("stroke","#00e676"),u.setAttribute("stroke-width","3"),u.setAttribute("stroke-dasharray","4 3"),r.appendChild(u)}}function $e(r){const t=/^r(\d+)c(\d+)$/.exec(r);if(!t)throw new Error(`Invalid node id: ${r}`);const e=Number(t[1]),c=Number(t[2]);if(!Number.isInteger(e)||!Number.isInteger(c))throw new Error(`Invalid node coordinates in id: ${r}`);return{r:e,c}}function he(r,t){return`r${r}c${t}`}function te(r,t){return r>=0&&r<=6&&t>=0&&t<=6}function pe(r,t){return te(r,t)&&(r+t)%2===0}function Re(r){const t=[],e=c=>!r.board.has(c)||(r.board.get(c)??[]).length===0;for(const[c,i]of r.board.entries()){if(!i||i.length===0)continue;const n=i[i.length-1];if(n.owner!==r.toMove)continue;const{r:o,c:u}=$e(c),f=[];if(n.rank==="S"){const l=n.owner==="B"?1:-1;for(const s of[-1,1]){const a=o+l,h=u+s;if(te(a,h)&&pe(a,h)){const g=he(a,h);e(g)&&f.push(g)}}}else{const l=[{dr:-1,dc:-1},{dr:-1,dc:1},{dr:1,dc:-1},{dr:1,dc:1}];for(const{dr:s,dc:a}of l){const h=o+s,g=u+a;if(te(h,g)&&pe(h,g)){const y=he(h,g);e(y)&&f.push(y)}}}for(const l of f)t.push({from:c,to:l,kind:"move"})}return t}function Ye(r,t){const e=new Map(r.board),c=e.get(t.from);if(!c||c.length===0)return r;e.set(t.to,c),e.delete(t.from);const i=r.toMove==="B"?"W":"B";return{board:e,toMove:i,phase:"idle"}}class Pe{constructor(t,e,c,i){this.selected=null,this.currentTargets=[],this.svg=t,this.piecesLayer=e,this.inspector=c,this.overlayLayer=we(t),this.state=i}bind(){this.svg.addEventListener("click",t=>this.onClick(t))}setState(t){this.state=t,this.updatePanel()}updatePanel(){const t=document.getElementById("statusTurn"),e=document.getElementById("statusPhase"),c=document.getElementById("statusMessage");t&&(t.textContent=this.state.toMove==="B"?"Black":"White"),e&&(e.textContent=this.selected?"Select":"Idle"),c&&(this.selected?c.textContent=this.currentTargets.length>0?"Choose a destination":"No quiet moves":c.textContent="—")}resolveClickedNode(t){if(t&&t instanceof Element){const e=t.closest("[data-node]");if(e){const i=e.getAttribute("data-node");if(i)return i}const c=t.closest("g.stack");if(c){const i=c.getAttribute("data-node");if(i)return i}if(t instanceof SVGCircleElement){const i=t.getAttribute("id");if(i)return i}}return null}svgPointFromClient(t){const e=this.svg.createSVGPoint?this.svg.createSVGPoint():null;if(e&&this.svg.getScreenCTM){e.x=t.clientX,e.y=t.clientY;const i=this.svg.getScreenCTM();if(i&&i.inverse){const n=e.matrixTransform(i.inverse());return{x:n.x,y:n.y}}}const c=this.svg.getBoundingClientRect();return{x:t.clientX-c.left,y:t.clientY-c.top}}hitTestTargets(t){if(!this.selected||this.currentTargets.length===0)return null;const{x:e,y:c}=this.svgPointFromClient(t);for(const i of this.currentTargets){const n=document.getElementById(i);if(!n)continue;const o=parseFloat(n.getAttribute("cx")||"0"),u=parseFloat(n.getAttribute("cy")||"0"),f=parseFloat(n.getAttribute("r")||"0"),l=e-o,s=c-u;if(Math.sqrt(l*l+s*s)<=f+12)return i}return null}isOwnStack(t){const e=this.state.board.get(t);return!e||e.length===0?!1:e[e.length-1].owner===this.state.toMove}showSelection(t){ue(this.overlayLayer),Fe(this.overlayLayer,t);const e=Re(this.state).filter(c=>c.from===t);this.currentTargets=e.map(c=>c.to),Ge(this.overlayLayer,this.currentTargets),this.updatePanel()}clearSelection(){this.selected=null,this.currentTargets=[],ue(this.overlayLayer),this.updatePanel()}onClick(t){let e=this.resolveClickedNode(t.target);if(e||(e=this.hitTestTargets(t)),!e){this.clearSelection();return}if(this.selected&&this.currentTargets.includes(e)){const c={from:this.selected,to:e},i=Ye(this.state,c);this.state=i,ge(this.svg,this.piecesLayer,this.inspector,this.state),this.clearSelection();return}this.isOwnStack(e)?(this.selected=e,this.showSelection(e)):this.clearSelection()}}window.addEventListener("DOMContentLoaded",async()=>{const r=document.getElementById("boardWrap");if(!r)throw new Error("Missing board container: #boardWrap");const t=new URL(""+new URL("lasca_board-C7LnMF4x.svg",import.meta.url).href,import.meta.url),e=await Te(r,t),c=document.getElementById("zoomTitle"),i=document.getElementById("zoomHint"),n=document.getElementById("zoomBody");if(!n)throw new Error("Missing inspector container: #zoomBody");const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.id="zoomSvg",o.setAttribute("xmlns","http://www.w3.org/2000/svg"),o.setAttribute("viewBox","0 0 120 200"),o.setAttribute("role","img"),o.setAttribute("aria-label","Stack column"),n.replaceChildren(o),Be();const u=document.getElementById("themeDropdown");await Ue(e).bindThemeDropdown(u);const l=e.querySelector("#pieces");if(!l)throw new Error("Missing SVG group inside board: #pieces");if(!c||!i)throw new Error("Missing inspector DOM nodes (zoomTitle/zoomHint)");const s=Ne(c,i,o),a=ve(),h=document.getElementById("statusTurn"),g=document.getElementById("statusPhase"),y=document.getElementById("statusMessage");h&&(h.textContent=a.toMove==="B"?"Black":"White"),g&&(g.textContent=a.phase.charAt(0).toUpperCase()+a.phase.slice(1)),y&&(y.textContent="—"),ge(e,l,s,a),we(e),new Pe(e,l,s,a).bind()});
