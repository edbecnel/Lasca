(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))i(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function e(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function i(n){if(n.ep)return;n.ep=!0;const o=e(n);fetch(n.href,o)}})();const Ae=["r0c0","r0c2","r0c4","r0c6","r1c1","r1c3","r1c5","r2c0","r2c2","r2c4","r2c6"],Le=["r4c0","r4c2","r4c4","r4c6","r5c1","r5c3","r5c5","r6c0","r6c2","r6c4","r6c6"];function Ee(){const r=new Map;for(const t of Ae)r.set(t,[{owner:"B",rank:"S"}]);for(const t of Le)r.set(t,[{owner:"W",rank:"S"}]);return{board:r,toMove:"W",phase:"select"}}function de(r){return r.owner==="W"&&r.rank==="S"?"#W_S":r.owner==="W"&&r.rank==="O"?"#W_O":r.owner==="B"&&r.rank==="S"?"#B_S":"#B_O"}const Be="http://www.w3.org/2000/svg",Ie="http://www.w3.org/1999/xlink";function ue(r,t,e,i){const n=document.createElementNS(Be,"use");return n.setAttribute("href",r),n.setAttributeNS(Ie,"xlink:href",r),n.setAttribute("width",String(i)),n.setAttribute("height",String(i)),n.setAttribute("x",String(t)),n.setAttribute("y",String(e)),n}const Z=6,fe=Math.floor(Z/2),ve=Z-fe,_="http://www.w3.org/2000/svg";function Ne(r,t,e,i,n,o={}){const{pieceSize:c=86,maxShown:d=Z,keepTop:a=ve,keepBottom:l=fe,miniSize:s=18,miniGap:u=3,spineGap:h=10,spinePad:g=6,crackGap:w=12}=o,p=n.length;if(p<=1)return;let f=[],m=!1;if(p<=d)f=n.slice();else{m=!0;const N=n.slice(0,l),T=n.slice(p-a);f=N.concat(T)}const k=f.length,L=k*s+(k-1)*u+(m?w:0),S=s+g*2,v=L+g*2,y=e+c/2+h,x=i-v/2,C=document.createElementNS(_,"rect");C.setAttribute("x",String(y)),C.setAttribute("y",String(x)),C.setAttribute("width",String(S)),C.setAttribute("height",String(v)),C.setAttribute("rx","10"),C.setAttribute("fill","rgba(0,0,0,0.28)"),C.setAttribute("stroke","rgba(255,255,255,0.35)"),C.setAttribute("stroke-width","1.4"),C.setAttribute("pointer-events","none"),t.appendChild(C);const D=r.querySelector("defs");if(!D)throw new Error("SVG <defs> not found. miniSpine requires <defs>.");const O=`clip_${Math.random().toString(16).slice(2)}`,M=document.createElementNS(_,"clipPath");M.setAttribute("id",O);const E=document.createElementNS(_,"rect");E.setAttribute("x",String(y+1)),E.setAttribute("y",String(x+1)),E.setAttribute("width",String(S-2)),E.setAttribute("height",String(v-2)),E.setAttribute("rx","9"),M.appendChild(E),D.appendChild(M);const W=document.createElementNS(_,"g");W.setAttribute("clip-path",`url(#${O})`),W.setAttribute("pointer-events","none");const G=y+g,b=x+v-g,A=l-1;for(let N=0;N<k;N++){const T=f[N],U=de(T);let J=N*(s+u);m&&N>A&&(J+=w);const X=b-s-J,z=G;W.appendChild(ue(U,z,X,s))}if(t.appendChild(W),m){const T=b-s-A*(s+u)-u-w/2,U=y+3,J=y+S-3,X=(U+J)/2,z=[`M ${U} ${T-5}`,`L ${X-6} ${T+2}`,`L ${X} ${T-3}`,`L ${X+6} ${T+4}`,`L ${J} ${T-1}`].join(" "),$=document.createElementNS(_,"path");$.setAttribute("d",z),$.setAttribute("fill","none"),$.setAttribute("stroke","rgba(0,0,0,0.45)"),$.setAttribute("stroke-width","4.0"),$.setAttribute("stroke-linecap","round"),$.setAttribute("stroke-linejoin","round"),$.setAttribute("pointer-events","none");const R=document.createElementNS(_,"path");R.setAttribute("d",z),R.setAttribute("fill","none"),R.setAttribute("stroke","rgba(255,255,255,0.75)"),R.setAttribute("stroke-width","2.2"),R.setAttribute("stroke-linecap","round"),R.setAttribute("stroke-linejoin","round"),R.setAttribute("pointer-events","none"),t.appendChild($),t.appendChild(R)}const I=y+S/2,j=x-12,F=document.createElementNS(_,"circle");F.setAttribute("cx",String(I)),F.setAttribute("cy",String(j)),F.setAttribute("r","10"),F.setAttribute("fill","rgba(0,0,0,0.78)"),F.setAttribute("stroke","rgba(255,255,255,0.65)"),F.setAttribute("stroke-width","1.4"),F.setAttribute("pointer-events","none");const B=document.createElementNS(_,"text");B.setAttribute("x",String(I)),B.setAttribute("y",String(j+.5)),B.setAttribute("text-anchor","middle"),B.setAttribute("dominant-baseline","middle"),B.setAttribute("fill","#fff"),B.setAttribute("font-size","12"),B.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),B.textContent=String(p),B.setAttribute("pointer-events","none"),t.appendChild(F),t.appendChild(B)}function Me(r,t,e,i,n,o={}){const{pieceSize:c=86}=o,d=document.getElementById(i);if(!d||!n.length)return;const a=parseFloat(d.getAttribute("cx")||"0"),l=parseFloat(d.getAttribute("cy")||"0"),s=document.createElementNS("http://www.w3.org/2000/svg","g");s.setAttribute("data-node",i),s.setAttribute("class","stack");const u=n[n.length-1],h=c/2;s.appendChild(ue(de(u),a-h,l-h,c)),Ne(r,s,a,l,n,{pieceSize:c,miniSize:18}),e&&n.length>1&&(s.style.cursor="pointer",s.addEventListener("pointerenter",()=>{e.cancelHide(),e.show(i,n)}),s.addEventListener("pointerleave",()=>{e.hideSoon()})),t.appendChild(s)}function se(r,t,e,i){t.textContent="";for(const[n,o]of i.board.entries())Me(r,t,e,n,o)}const K="http://www.w3.org/2000/svg";function Te(r,t,e){let i=null;function n(){for(;e.firstChild;)e.removeChild(e.firstChild);e.setAttribute("viewBox","0 0 120 200"),e.removeAttribute("height")}function o(a,l){const s=l.length;for(r.textContent=`Stack @ ${a} (×${s})`,t.textContent=s>Z?"Full column order (bottom → top). Brackets mark pieces omitted in the mini preview spine.":"Full column order (bottom → top).";e.firstChild;)e.removeChild(e.firstChild);const u=22,h=4,g=26,w=24,p=120,f=s*u+(s-1)*h,m=g+f+w;e.setAttribute("viewBox",`0 0 ${p} ${m}`),e.setAttribute("height",String(m));const k=p/2-u/2,L=g,S=document.createElementNS(K,"rect");S.setAttribute("x",String(k-8)),S.setAttribute("y",String(L-10)),S.setAttribute("width",String(u+16)),S.setAttribute("height",String(f+20)),S.setAttribute("rx","12"),S.setAttribute("fill","rgba(0,0,0,0.28)"),S.setAttribute("stroke","rgba(255,255,255,0.18)"),S.setAttribute("stroke-width","1.4"),e.appendChild(S);const v=document.createElementNS(K,"text");v.setAttribute("x",String(p/2)),v.setAttribute("y",String(L-12)),v.setAttribute("text-anchor","middle"),v.setAttribute("fill","rgba(255,255,255,0.85)"),v.setAttribute("font-size","12"),v.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),v.textContent="TOP",e.appendChild(v);const y=document.createElementNS(K,"text");y.setAttribute("x",String(p/2)),y.setAttribute("y",String(L+f+18)),y.setAttribute("text-anchor","middle"),y.setAttribute("fill","rgba(255,255,255,0.85)"),y.setAttribute("font-size","12"),y.setAttribute("font-family","system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif"),y.textContent="BOTTOM",e.appendChild(y);for(let x=0;x<s;x++){const C=l[x],D=de(C),O=L+(s-1-x)*(u+h);e.appendChild(ue(D,k,O,u))}if(s>Z){const x=fe,C=ve,D=x,O=s-C-1;if(O>=D){const M=L+(s-1-O)*(u+h),E=L+(s-1-D)*(u+h)+u,W=k-18,G=k+u+18,b=10,A=document.createElementNS(K,"path");A.setAttribute("d",`M ${W+b} ${M} L ${W} ${M} L ${W} ${E} L ${W+b} ${E}`),A.setAttribute("fill","none"),A.setAttribute("stroke","rgba(255,255,255,0.90)"),A.setAttribute("stroke-width","2.2"),A.setAttribute("stroke-linecap","round"),A.setAttribute("stroke-linejoin","round"),e.appendChild(A);const I=document.createElementNS(K,"path");I.setAttribute("d",`M ${G-b} ${M} L ${G} ${M} L ${G} ${E} L ${G-b} ${E}`),I.setAttribute("fill","none"),I.setAttribute("stroke","rgba(255,255,255,0.90)"),I.setAttribute("stroke-width","2.2"),I.setAttribute("stroke-linecap","round"),I.setAttribute("stroke-linejoin","round"),e.appendChild(I)}}}function c(){i&&clearTimeout(i),i=null}function d(){i&&clearTimeout(i),i=setTimeout(()=>{r.textContent="Lasca Stack Inspector",t.textContent="Hover a stacked piece to see the full column order (bottom → top). If a crack appears on the mini spine, brackets mark the omitted middle here.",n()},80)}return{show:o,hideSoon:d,cancelHide:c,clearZoom:n}}const P="lasca.layout.",V=22,Q={leftWidth:280,rightWidth:320,leftCollapsed:!1,rightCollapsed:!1};function Y(r,t,e){return Math.max(t,Math.min(e,r))}function pe(r,t){const e=localStorage.getItem(r);if(e==null)return t;const i=Number(e);return Number.isFinite(i)?i:t}function ge(r,t){const e=localStorage.getItem(r);return e==null?t:e==="1"}function be(r,t){localStorage.setItem(r,String(Math.round(t)))}function we(r,t){localStorage.setItem(r,t?"1":"0")}function Oe(r={}){const t=r.root??document.getElementById("appRoot"),e=r.left??document.getElementById("leftSidebar"),i=r.right??document.getElementById("rightSidebar"),n=r.gutterLeft??document.getElementById("gutterLeft"),o=r.gutterRight??document.getElementById("gutterRight");if(!t||!e||!i||!n||!o)throw new Error("splitLayout: missing root/sidebars/gutters");const c=t.querySelector('[data-action="collapse-left"]'),d=t.querySelector('[data-action="collapse-right"]'),a=t.querySelector('[data-action="expand-left"]'),l=t.querySelector('[data-action="expand-right"]'),s=420,u=200,h=520,g=240,w=560;let p=pe(P+"leftWidth",Q.leftWidth),f=pe(P+"rightWidth",Q.rightWidth),m=ge(P+"leftCollapsed",Q.leftCollapsed),k=ge(P+"rightCollapsed",Q.rightCollapsed),L=p,S=f;function v(){return t.getBoundingClientRect().width}function y(){return n.getBoundingClientRect().width+o.getBoundingClientRect().width}function x(){e.style.width=m?`${V}px`:`${p}px`,i.style.width=k?`${V}px`:`${f}px`,e.classList.toggle("collapsed",m),i.classList.toggle("collapsed",k),n.classList.toggle("disabled",m),o.classList.toggle("disabled",k),be(P+"leftWidth",p),be(P+"rightWidth",f),we(P+"leftCollapsed",m),we(P+"rightCollapsed",k)}function C(){const b=v(),A=k?V:f;return b-y()-A-s}function D(){const b=v(),A=m?V:p;return b-y()-A-s}function O(b){m!==b&&(b?L=p:p=Y(L,u,Math.min(h,C())),m=b,x())}function M(b){k!==b&&(b?S=f:f=Y(S,g,Math.min(w,D())),k=b,x())}function E(){m||(p=Y(p,u,Math.min(h,C()))),k||(f=Y(f,g,Math.min(w,D()))),x()}function W(b){if(m)return;const A=b.clientX,I=p,j=Math.min(h,C()),F=u;function B(T){const U=T.clientX-A;p=Y(I+U,F,j),x()}function N(){window.removeEventListener("pointermove",B),window.removeEventListener("pointerup",N);try{n.releasePointerCapture(b.pointerId)}catch{}}n.setPointerCapture(b.pointerId),window.addEventListener("pointermove",B),window.addEventListener("pointerup",N)}function G(b){if(k)return;const A=b.clientX,I=f,j=Math.min(w,D()),F=g;function B(T){const U=T.clientX-A;f=Y(I-U,F,j),x()}function N(){window.removeEventListener("pointermove",B),window.removeEventListener("pointerup",N);try{o.releasePointerCapture(b.pointerId)}catch{}}o.setPointerCapture(b.pointerId),window.addEventListener("pointermove",B),window.addEventListener("pointerup",N)}return n.addEventListener("pointerdown",W),o.addEventListener("pointerdown",G),n.addEventListener("dblclick",()=>O(!m)),o.addEventListener("dblclick",()=>M(!k)),c==null||c.addEventListener("click",()=>O(!0)),a==null||a.addEventListener("click",()=>O(!1)),d==null||d.addEventListener("click",()=>M(!0)),l==null||l.addEventListener("click",()=>M(!1)),E(),window.addEventListener("resize",E),{getState:()=>({leftWidth:p,rightWidth:f,leftCollapsed:m,rightCollapsed:k}),setLeftCollapsed:O,setRightCollapsed:M,setLeftWidth:b=>{p=b,E()},setRightWidth:b=>{f=b,E()}}}async function Fe(r,t){if(!r)throw new Error("loadSvgFileInto: containerEl is required");const e=await fetch(t);if(!e.ok)throw new Error(`loadSvgFileInto: failed to fetch ${String(t)} (${e.status})`);const i=await e.text(),o=new DOMParser().parseFromString(i,"image/svg+xml").documentElement;if(!o||o.nodeName.toLowerCase()!=="svg")throw new Error(`loadSvgFileInto: ${String(t)} did not parse as an <svg> root`);const c=document.importNode(o,!0);return r.replaceChildren(c),c}async function De(r,t){if(!r)throw new Error("loadSvgDefsInto: targetEl is required");if(!(!Array.isArray(t)||t.length===0))for(const e of t){const i=await fetch(e);if(!i.ok)throw new Error(`loadSvgDefsInto: failed to fetch ${String(e)} (${i.status})`);const n=await i.text(),o=new DOMParser().parseFromString(n,"image/svg+xml"),c=o.querySelector("defs"),d=c?Array.from(c.children):Array.from(o.documentElement.children);for(const a of d)r.appendChild(document.importNode(a,!0))}}const ie="classic",le=[{id:"classic",label:"Classic",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20PIECE%20SYMBOLS%20(W_S,%20B_S,%20W_O,%20B_O)%20========%20--%3e%3cradialGradient%20id='gradWhite'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ffffff'/%3e%3cstop%20offset='55%25'%20stop-color='%23f1f1f1'/%3e%3cstop%20offset='100%25'%20stop-color='%23d6d6d6'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradBlack'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23444444'/%3e%3cstop%20offset='55%25'%20stop-color='%231c1c1c'/%3e%3cstop%20offset='100%25'%20stop-color='%23050505'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradGreen'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%237be58a'/%3e%3cstop%20offset='55%25'%20stop-color='%231fb34a'/%3e%3cstop%20offset='100%25'%20stop-color='%230a6f2a'/%3e%3c/radialGradient%3e%3cradialGradient%20id='gradRed'%20cx='35%25'%20cy='30%25'%20r='70%25'%3e%3cstop%20offset='0%25'%20stop-color='%23ff8f8f'/%3e%3cstop%20offset='55%25'%20stop-color='%23e12a2a'/%3e%3cstop%20offset='100%25'%20stop-color='%238f1111'/%3e%3c/radialGradient%3e%3cpath%20id='star5'%20d='%20M%2050%2030%20L%2056.5%2043.2%20L%2071.0%2045.3%20L%2060.5%2055.6%20L%2063.0%2070.0%20L%2050.0%2063.2%20L%2037.0%2070.0%20L%2039.5%2055.6%20L%2029.0%2045.3%20L%2043.5%2043.2%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradWhite)'%20stroke='%23111'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.28'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradBlack)'%20stroke='%23f5f5f5'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.16'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.10'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradGreen)'%20stroke='%230b2a12'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.18'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='43'%20fill='url(%23gradRed)'%20stroke='%233a0b0b'%20stroke-width='6'/%3e%3ccircle%20cx='50'%20cy='50'%20r='33'%20fill='none'%20stroke='%23000'%20stroke-opacity='0.18'%20stroke-width='3'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.95'/%3e%3ccircle%20cx='50'%20cy='50'%20r='18'%20fill='none'%20stroke='%23fff'%20stroke-opacity='0.55'%20stroke-width='3'/%3e%3cellipse%20cx='40'%20cy='36'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.16'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvY2xhc3NpYy90aGVtZS5jc3MgKi8KOnJvb3R7CiAgLS1wYWdlLWJnOiAjMWIxYjFiOwogIC0tcGFuZWwtYmc6IHJnYmEoMjU1LDI1NSwyNTUsMC4wNik7CiAgLS1wYW5lbC1ib3JkZXI6IHJnYmEoMjU1LDI1NSwyNTUsMC4xMCk7CiAgLS1wYW5lbC10ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuOTApOwogIC0tcGFuZWwtc3VidGV4dDogcmdiYSgyNTUsMjU1LDI1NSwwLjcwKTsKfQoKLyogU2xpZ2h0bHkgd2FybSBib2FyZCBjb25uZWN0b3JzL25vZGVzICovCiNsYXNjYUJvYXJkICNjb25uZWN0b3JzeyBzdHJva2U6ICMxMTE7IH0KI2xhc2NhQm9hcmQgI25vZGVzeyBzdHJva2U6ICMxMTE7IH0K",import.meta.url)},{id:"highContrast",label:"High Contrast",piecesDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20High-contrast%20flat%20pieces:%20same%20IDs%20(%23W_S,%20%23B_S,%20%23W_O,%20%23B_O)%20--%3e%3cpath%20id='star5'%20d='%20M%2050%2025%20L%2058%2042%20L%2077%2045%20L%2063%2058%20L%2066%2077%20L%2050%2068%20L%2034%2077%20L%2037%2058%20L%2023%2045%20L%2042%2042%20Z'%20/%3e%3c!--%20White%20Soldier%20--%3e%3csymbol%20id='W_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ffffff'%20stroke='%23000000'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23000000'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23000'%20opacity='0.06'/%3e%3c/symbol%3e%3c!--%20Black%20Soldier%20--%3e%3csymbol%20id='B_S'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23000000'%20stroke='%23ffffff'%20stroke-width='8'/%3e%3ccircle%20cx='50'%20cy='50'%20r='32'%20fill='none'%20stroke='%23ffffff'%20stroke-width='6'%20opacity='0.18'/%3e%3cellipse%20cx='38'%20cy='34'%20rx='18'%20ry='12'%20fill='%23fff'%20opacity='0.12'/%3e%3c/symbol%3e%3c!--%20Green%20Officer%20(paired%20with%20White%20Soldier)%20--%3e%3csymbol%20id='W_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%2321c75a'%20stroke='%23001a08'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c!--%20Red%20Officer%20(paired%20with%20Black%20Soldier)%20--%3e%3csymbol%20id='B_O'%20viewBox='0%200%20100%20100'%3e%3ccircle%20cx='50'%20cy='50'%20r='44'%20fill='%23ff2a2a'%20stroke='%231a0000'%20stroke-width='8'/%3e%3cuse%20href='%23star5'%20fill='%23ffffff'%20opacity='0.98'/%3e%3ccircle%20cx='50'%20cy='50'%20r='20'%20fill='none'%20stroke='%23ffffff'%20stroke-width='4'%20opacity='0.7'/%3e%3c/symbol%3e%3c/defs%3e%3c/svg%3e",import.meta.url),boardDefs:new URL("data:image/svg+xml,%3c?xml%20version='1.0'%20encoding='UTF-8'?%3e%3csvg%20xmlns='http://www.w3.org/2000/svg'%20viewBox='0%200%201%201'%20aria-hidden='true'%3e%3cdefs%3e%3c!--%20========%20CONNECTOR%20MASK%20(prevents%20lines%20inside%20nodes)%20========%20--%3e%3cmask%20id='mask-connectors'%20maskUnits='userSpaceOnUse'%20maskContentUnits='userSpaceOnUse'%3e%3crect%20x='0'%20y='0'%20width='1000'%20height='1000'%20fill='white'/%3e%3c!--%20hole%20radius%20chosen%20so%20lines%20can%20tuck%20slightly%20under%20the%20ring%20--%3e%3c!--%20node%20r%20=%2046,%20hole%20r%20=%2042%20--%3e%3c!--%20row%200%20--%3e%3ccircle%20cx='140'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='140'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='140'%20r='42'%20fill='black'/%3e%3c!--%20row%201%20--%3e%3ccircle%20cx='260'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='260'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='260'%20r='42'%20fill='black'/%3e%3c!--%20row%202%20--%3e%3ccircle%20cx='140'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='380'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='380'%20r='42'%20fill='black'/%3e%3c!--%20row%203%20--%3e%3ccircle%20cx='260'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='500'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='500'%20r='42'%20fill='black'/%3e%3c!--%20row%204%20--%3e%3ccircle%20cx='140'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='620'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='620'%20r='42'%20fill='black'/%3e%3c!--%20row%205%20--%3e%3ccircle%20cx='260'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='500'%20cy='740'%20r='42'%20fill='black'/%3e%3ccircle%20cx='740'%20cy='740'%20r='42'%20fill='black'/%3e%3c!--%20row%206%20--%3e%3ccircle%20cx='140'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='380'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='620'%20cy='860'%20r='42'%20fill='black'/%3e%3ccircle%20cx='860'%20cy='860'%20r='42'%20fill='black'/%3e%3c/mask%3e%3c/defs%3e%3c/svg%3e",import.meta.url),css:new URL("data:text/css;base64,Lyogc3JjL2Fzc2V0cy90aGVtZXMvaGlnaENvbnRyYXN0L3RoZW1lLmNzcyAqLwo6cm9vdHsKICAtLXBhZ2UtYmc6ICMwYjBiMGI7CiAgLS1wYW5lbC1iZzogcmdiYSgyNTUsMjU1LDI1NSwwLjA4KTsKICAtLXBhbmVsLWJvcmRlcjogcmdiYSgyNTUsMjU1LDI1NSwwLjE0KTsKICAtLXBhbmVsLXRleHQ6IHJnYmEoMjU1LDI1NSwyNTUsMC45NCk7CiAgLS1wYW5lbC1zdWJ0ZXh0OiByZ2JhKDI1NSwyNTUsMjU1LDAuNzgpOwp9CgovKiBNYWtlIGJvYXJkIGxpbmVzL3JpbmdzIG1vcmUgdmlzaWJsZSAqLwojbGFzY2FCb2FyZCAjY29ubmVjdG9yc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CiNsYXNjYUJvYXJkICNub2Rlc3sgc3Ryb2tlOiByZ2JhKDI1NSwyNTUsMjU1LDAuODIpOyB9CgovKiBCb29zdCBzcGluZSBidWJibGUgY29udHJhc3QgKi8KI2xhc2NhQm9hcmQgdGV4dHsgcGFpbnQtb3JkZXI6IHN0cm9rZTsgc3Ryb2tlOiByZ2JhKDAsMCwwLDAuNTUpOyBzdHJva2Utd2lkdGg6IDJweDsgfQo=",import.meta.url)}];function ee(r){return le.find(t=>t.id===r)??null}function We(r){const{rootEl:t,items:e,initialId:i,onSelect:n}=r??{};if(!t)throw new Error("createThemeDropdown: rootEl is required");if(!Array.isArray(e)||e.length===0)throw new Error("createThemeDropdown: items is required");const o=t.querySelector("#themeDropdownBtn"),c=t.querySelector("#themeDropdownMenu");if(!o||!c)throw new Error("createThemeDropdown: missing #themeDropdownBtn / #themeDropdownMenu");let d=!1,a=i??e[0].id;function l(f){d=f,o.setAttribute("aria-expanded",d?"true":"false"),d?(c.hidden=!1,c.focus({preventScroll:!0})):c.hidden=!0}function s(){const f=e.find(m=>m.id===a)??e[0];o.textContent=f?`${f.label} ▾`:"Theme ▾"}function u(){c.textContent="";for(const f of e){const m=document.createElement("button");m.type="button",m.className="themeOption",m.setAttribute("role","option"),m.setAttribute("data-id",f.id),m.setAttribute("aria-selected",f.id===a?"true":"false"),m.textContent=f.label,m.addEventListener("click",async()=>{await h(f.id),l(!1),o.focus({preventScroll:!0})}),c.appendChild(m)}}async function h(f){a=f,s(),u(),typeof n=="function"&&await n(f)}function g(f){if(!d)return;const m=f.target;m instanceof Node&&(t.contains(m)||l(!1))}function w(){l(!d)}function p(f){d&&f.key==="Escape"&&(f.preventDefault(),l(!1),o.focus({preventScroll:!0}))}return o.addEventListener("click",w),document.addEventListener("pointerdown",g),c.addEventListener("keydown",p),o.setAttribute("aria-haspopup","listbox"),c.setAttribute("role","listbox"),c.tabIndex=-1,s(),u(),l(!1),{setSelected:async f=>h(f),getSelected:()=>a,open:()=>l(!0),close:()=>l(!1),destroy:()=>{o.removeEventListener("click",w),document.removeEventListener("pointerdown",g),c.removeEventListener("keydown",p)}}}const xe="lasca.theme",ye="lascaThemeCss";function Ge(r){const t="http://www.w3.org/2000/svg";let e=r.querySelector("defs");e||(e=document.createElementNS(t,"defs"),e.setAttribute("id","lascaDefs"),r.insertBefore(e,r.firstChild));let i=r.querySelector("#lascaThemeDefs");i||(i=document.createElementNS(t,"g"),i.setAttribute("id","lascaThemeDefs"),e.appendChild(i));let n=r.querySelector("#lascaRuntimeDefs");return n||(n=document.createElementNS(t,"g"),n.setAttribute("id","lascaRuntimeDefs"),e.appendChild(n)),{defs:e,themeDefs:i,runtimeDefs:n}}function Ue(){let r=document.getElementById(ye);return r&&r.tagName.toLowerCase()!=="link"&&(r.remove(),r=null),r||(r=document.createElement("link"),r.id=ye,r.rel="stylesheet",document.head.appendChild(r)),r}function ke(){const r=localStorage.getItem(xe);return r||null}function $e(r){localStorage.setItem(xe,r)}function Re(r){if(!r)throw new Error("createThemeManager: svgRoot is required");const{themeDefs:t}=Ge(r);let e=null,i=null;async function n(a){if(!a)return;const l=String(a);if(l===i)return;const s=Ue();await new Promise(u=>{const h=()=>{s.removeEventListener("load",h),s.removeEventListener("error",h),u()};s.addEventListener("load",h),s.addEventListener("error",h),s.href=l}),i=l}async function o(a){const l=ee(a)??ee(ie);if(!l)throw new Error("No themes available.");if(e===l.id)return l;const s=r.style.visibility;return r.style.visibility="hidden",t.replaceChildren(),await De(t,[l.piecesDefs,l.boardDefs]),await n(l.css),e=l.id,$e(e),r.style.visibility=s||"visible",l}async function c(a){if(!a)return;const l=le.map(g=>({id:g.id,label:g.label})),s=ke(),u=s&&ee(s)?s:ie;await o(u),await We({rootEl:a,items:l,initialId:u,onSelect:async g=>{await o(g)}}).setSelected(u)}async function d(a){if(!a)return;a.textContent="";for(const u of le){const h=document.createElement("option");h.value=u.id,h.textContent=u.label,a.appendChild(h)}const l=ke(),s=l&&ee(l)?l:ie;a.value=s,await o(s),a.addEventListener("change",async()=>{await o(a.value)})}return{setTheme:o,bindThemeDropdown:c,bindThemeSelect:d,getCurrentThemeId:()=>e}}const ne="http://www.w3.org/2000/svg";function Ce(r){const t=r.querySelector("#overlays");if(t)return t;const e=document.createElementNS(ne,"g");e.id="overlays",e.setAttribute("pointer-events","none");const i=r.querySelector("#pieces");return i&&i.parentNode?i.nextSibling?i.parentNode.insertBefore(e,i.nextSibling):i.parentNode.appendChild(e):r.appendChild(e),e}function te(r){for(;r.firstChild;)r.removeChild(r.firstChild)}function he(r){return document.getElementById(r)}function _e(r,t){const e=he(t);if(!e)return;const i=parseFloat(e.getAttribute("cx")||"0"),n=parseFloat(e.getAttribute("cy")||"0"),o=parseFloat(e.getAttribute("r")||"0"),c=document.createElementNS(ne,"circle");c.setAttribute("cx",String(i)),c.setAttribute("cy",String(n)),c.setAttribute("r",String(o+6)),c.setAttribute("fill","none"),c.setAttribute("stroke","#66ccff"),c.setAttribute("stroke-width","3"),c.setAttribute("pointer-events","none"),r.appendChild(c)}function Pe(r,t){for(const e of t){const i=he(e);if(!i)continue;const n=parseFloat(i.getAttribute("cx")||"0"),o=parseFloat(i.getAttribute("cy")||"0"),c=parseFloat(i.getAttribute("r")||"0"),d=document.createElementNS(ne,"circle");d.setAttribute("cx",String(n)),d.setAttribute("cy",String(o)),d.setAttribute("r",String(c+10)),d.setAttribute("fill","none"),d.setAttribute("stroke","#00e676"),d.setAttribute("stroke-width","3"),d.setAttribute("stroke-dasharray","4 3"),r.appendChild(d)}}function oe(r,t,e="#ff9f40",i=4){const n=he(t);if(!n)return;const o=parseFloat(n.getAttribute("cx")||"0"),c=parseFloat(n.getAttribute("cy")||"0"),d=parseFloat(n.getAttribute("r")||"0"),a=document.createElementNS(ne,"circle");a.setAttribute("cx",String(o)),a.setAttribute("cy",String(c)),a.setAttribute("r",String(d+12)),a.setAttribute("fill","none"),a.setAttribute("stroke",e),a.setAttribute("stroke-width",String(i)),a.setAttribute("stroke-dasharray","6 4"),a.setAttribute("pointer-events","none"),r.appendChild(a)}function me(r){const t=/^r(\d+)c(\d+)$/.exec(r);if(!t)throw new Error(`Invalid node id: ${r}`);const e=Number(t[1]),i=Number(t[2]);if(!Number.isInteger(e)||!Number.isInteger(i))throw new Error(`Invalid node coordinates in id: ${r}`);return{r:e,c:i}}function re(r,t){return`r${r}c${t}`}function q(r,t){return r>=0&&r<=6&&t>=0&&t<=6}function ae(r,t){return q(r,t)&&(r+t)%2===0}function He(r){const t=[],e=n=>!r.board.has(n)||(r.board.get(n)??[]).length===0,i=n=>{const o=r.board.get(n);return!o||o.length===0?!1:o[o.length-1].owner!==r.toMove};for(const[n,o]of r.board.entries()){if(!o||o.length===0)continue;const c=o[o.length-1];if(c.owner!==r.toMove)continue;const{r:d,c:a}=me(n);let l=[];if(c.rank==="S"){const s=c.owner==="B"?2:-2;l=[{dr:s,dc:-2},{dr:s,dc:2}]}else l=[{dr:-2,dc:-2},{dr:-2,dc:2},{dr:2,dc:-2},{dr:2,dc:2}];for(const{dr:s,dc:u}of l){const h=d+s/2,g=a+u/2,w=d+s,p=a+u;if(!q(h,g)||!q(w,p)||!ae(w,p))continue;const f=re(h,g),m=re(w,p);i(f)&&e(m)&&t.push({kind:"capture",from:n,over:f,to:m})}}return t}function H(r){const t=He(r);if(t.length>0)return t;const e=[],i=n=>!r.board.has(n)||(r.board.get(n)??[]).length===0;for(const[n,o]of r.board.entries()){if(!o||o.length===0)continue;const c=o[o.length-1];if(c.owner!==r.toMove)continue;const{r:d,c:a}=me(n),l=[];if(c.rank==="S"){const s=c.owner==="B"?1:-1;for(const u of[-1,1]){const h=d+s,g=a+u;if(q(h,g)&&ae(h,g)){const w=re(h,g);i(w)&&l.push(w)}}}else{const s=[{dr:-1,dc:-1},{dr:-1,dc:1},{dr:1,dc:-1},{dr:1,dc:1}];for(const{dr:u,dc:h}of s){const g=d+u,w=a+h;if(q(g,w)&&ae(g,w)){const p=re(g,w);i(p)&&l.push(p)}}}for(const s of l)e.push({from:n,to:s,kind:"move"})}return e}function Se(r,t){const e=r.board.get(t);if(!e||e.length===0)return!1;const i=e[e.length-1];if(i.rank!=="S")return!1;const{r:n}=me(t);let o=!1;return(i.owner==="B"&&n===6||i.owner==="W"&&n===0)&&(o=!0),o?(i.rank="O",!0):!1}function je(r,t){if(t.kind==="capture"){const d=new Map(r.board),a=d.get(t.from);if(!a||a.length===0)throw new Error(`applyMove: no moving stack at ${t.from}`);const l=d.get(t.over);if(!l||l.length===0)throw new Error(`applyMove: no enemy stack to capture at ${t.over}`);const s=d.get(t.to);if(s&&s.length>0)throw new Error(`applyMove: landing square ${t.to} is not empty`);const u=l.pop();l.length===0?d.delete(t.over):d.set(t.over,l),d.set(t.to,a),a.unshift(u),d.delete(t.from);const h={...r,board:d},g=Se(h,t.to);return{board:d,toMove:r.toMove,phase:"idle",didPromote:g}}const e=new Map(r.board),i=e.get(t.from);if(!i||i.length===0)return r;e.set(t.to,i),e.delete(t.from);const n={...r,board:e},o=Se(n,t.to),c=r.toMove==="B"?"W":"B";return{board:e,toMove:c,phase:"idle",didPromote:o}}const Ye={stopCaptureOnPromotion:!0};function ce(r){const t=r.toMove,e=t==="B"?"W":"B";let i=!1;for(const o of r.board.values())if(o.length>0&&o[o.length-1].owner===e){i=!0;break}return i?H(r).length===0?{winner:t,reason:`${t==="B"?"Black":"White"} wins — ${e==="B"?"Black":"White"} has no moves`}:{winner:null,reason:null}:{winner:t,reason:`${t==="B"?"Black":"White"} wins — ${e==="B"?"Black":"White"} has no pieces`}}class Je{constructor(t,e,i,n){this.selected=null,this.currentTargets=[],this.currentMoves=[],this.mandatoryCapture=!1,this.lockedCaptureFrom=null,this.isGameOver=!1,this.moveHintsEnabled=!1,this.bannerTimer=null,this.remainderTimer=null,this.svg=t,this.piecesLayer=e,this.inspector=i,this.overlayLayer=Ce(t),this.state=n}bind(){this.svg.addEventListener("click",e=>this.onClick(e));const t=H(this.state);this.mandatoryCapture=t.length>0&&t[0].kind==="capture",this.updatePanel()}setMoveHints(t){this.moveHintsEnabled=t,this.selected&&this.showSelection(this.selected)}setState(t){this.state=t;const e=H(this.state);this.mandatoryCapture=e.length>0&&e[0].kind==="capture",this.updatePanel()}getState(){return this.state}updatePanel(){const t=document.getElementById("statusTurn"),e=document.getElementById("statusPhase"),i=document.getElementById("statusMessage");t&&(t.textContent=this.state.toMove==="B"?"Black":"White"),e&&(e.textContent=this.selected?"Select":"Idle"),i&&(this.selected?this.currentTargets.length>0?this.lockedCaptureFrom?i.textContent="Continue capturing":i.textContent="Choose a destination":this.mandatoryCapture?i.textContent="Capture required — select a capturing stack":i.textContent="No moves":this.mandatoryCapture?i.textContent="Capture available — you must capture":i.textContent="—")}resolveClickedNode(t){if(t&&t instanceof Element){const e=t.closest("[data-node]");if(e){const n=e.getAttribute("data-node");if(n)return n}const i=t.closest("g.stack");if(i){const n=i.getAttribute("data-node");if(n)return n}if(t instanceof SVGCircleElement){const n=t.getAttribute("id");if(n)return n}}return null}svgPointFromClient(t){const e=this.svg.createSVGPoint?this.svg.createSVGPoint():null;if(e&&this.svg.getScreenCTM){e.x=t.clientX,e.y=t.clientY;const n=this.svg.getScreenCTM();if(n&&n.inverse){const o=e.matrixTransform(n.inverse());return{x:o.x,y:o.y}}}const i=this.svg.getBoundingClientRect();return{x:t.clientX-i.left,y:t.clientY-i.top}}hitTestTargets(t){if(!this.selected||this.currentTargets.length===0)return null;const{x:e,y:i}=this.svgPointFromClient(t);for(const n of this.currentTargets){const o=document.getElementById(n);if(!o)continue;const c=parseFloat(o.getAttribute("cx")||"0"),d=parseFloat(o.getAttribute("cy")||"0"),a=parseFloat(o.getAttribute("r")||"0"),l=e-c,s=i-d;if(Math.sqrt(l*l+s*s)<=a+12)return n}return null}isOwnStack(t){const e=this.state.board.get(t);return!e||e.length===0?!1:e[e.length-1].owner===this.state.toMove}showSelection(t){te(this.overlayLayer),_e(this.overlayLayer,t);const e=H(this.state);this.mandatoryCapture=e.length>0&&e[0].kind==="capture";let i=e.filter(n=>n.from===t);if(this.lockedCaptureFrom&&this.lockedCaptureFrom!==t&&(i=[]),this.currentMoves=i,this.currentTargets=this.currentMoves.map(n=>n.to),Pe(this.overlayLayer,this.currentTargets),this.moveHintsEnabled)for(const n of this.currentMoves)n.kind==="capture"&&(oe(this.overlayLayer,n.over,"#ff6b6b",3),oe(this.overlayLayer,n.to,"#ff9f40",4));this.updatePanel()}clearSelection(){this.selected=null,this.currentTargets=[],this.currentMoves=[],this.mandatoryCapture=!1,this.lockedCaptureFrom=null,te(this.overlayLayer),this.updatePanel()}showBanner(t,e=1500){const i=document.getElementById("statusMessage");i&&(i.textContent=t),this.bannerTimer&&window.clearTimeout(this.bannerTimer),this.bannerTimer=window.setTimeout(()=>{this.bannerTimer=null,this.updatePanel()},e)}showRemainderHint(t,e=1200){oe(this.overlayLayer,t,"#ff9f40",4),this.remainderTimer&&window.clearTimeout(this.remainderTimer),this.remainderTimer=window.setTimeout(()=>{this.remainderTimer=null,te(this.overlayLayer),this.updatePanel()},e)}onClick(t){if(this.isGameOver)return;let e=this.resolveClickedNode(t.target);if(e||(e=this.hitTestTargets(t)),!e){this.clearSelection();return}if(this.selected&&this.currentTargets.includes(e)){const i=this.currentMoves.find(o=>o.to===e&&o.from===this.selected);if(!i){this.clearSelection();return}const n=je(this.state,i);if(this.state=n,se(this.svg,this.piecesLayer,this.inspector,this.state),this.remainderTimer&&(window.clearTimeout(this.remainderTimer),this.remainderTimer=null),te(this.overlayLayer),i.kind==="capture"){const o=n.didPromote||!1,d=H(this.state).filter(s=>s.kind==="capture").filter(s=>s.from===i.to);if(o&&Ye.stopCaptureOnPromotion){this.state={...this.state,toMove:this.state.toMove==="B"?"W":"B"},this.lockedCaptureFrom=null,this.clearSelection();const s=H(this.state);this.mandatoryCapture=s.length>0&&s[0].kind==="capture";const u=ce(this.state);if(u.winner){this.isGameOver=!0,this.showBanner(u.reason||"Game Over",0);return}this.showBanner("Promoted — capture turn ends");return}if(d.length>0){this.lockedCaptureFrom=i.to,this.selected=i.to,this.showSelection(i.to),this.showBanner("Continue capture");return}this.state={...this.state,toMove:this.state.toMove==="B"?"W":"B"},this.lockedCaptureFrom=null,this.clearSelection();const a=H(this.state);this.mandatoryCapture=a.length>0&&a[0].kind==="capture";const l=ce(this.state);if(l.winner){this.isGameOver=!0,this.showBanner(l.reason||"Game Over",0);return}this.showBanner("Turn changed")}else{this.clearSelection();const o=H(this.state);this.mandatoryCapture=o.length>0&&o[0].kind==="capture";const c=ce(this.state);if(c.winner){this.isGameOver=!0,this.showBanner(c.reason||"Game Over",0);return}this.updatePanel()}return}if(this.lockedCaptureFrom){if(e===this.lockedCaptureFrom){this.selected=e,this.showSelection(e);return}return}this.isOwnStack(e)?(this.selected=e,this.showSelection(e)):this.clearSelection()}}function Xe(r){return{board:Array.from(r.board.entries()),toMove:r.toMove,phase:r.phase}}function Ke(r){return{board:new Map(r.board),toMove:r.toMove,phase:r.phase}}function Ze(r,t="lasca-game.json"){const e=Xe(r),i=JSON.stringify(e,null,2),n=new Blob([i],{type:"application/json"}),o=URL.createObjectURL(n),c=document.createElement("a");c.href=o,c.download=t,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(o)}function qe(r){return new Promise((t,e)=>{const i=new FileReader;i.onload=n=>{var o;try{const c=(o=n.target)==null?void 0:o.result,d=JSON.parse(c),a=Ke(d);t(a)}catch(c){e(new Error(`Failed to load game: ${c}`))}},i.onerror=()=>{e(new Error("Failed to read file"))},i.readAsText(r)})}window.addEventListener("DOMContentLoaded",async()=>{const r=document.getElementById("boardWrap");if(!r)throw new Error("Missing board container: #boardWrap");const t=new URL(""+new URL("lasca_board-C7LnMF4x.svg",import.meta.url).href,import.meta.url),e=await Fe(r,t),i=document.getElementById("zoomTitle"),n=document.getElementById("zoomHint"),o=document.getElementById("zoomBody");if(!o)throw new Error("Missing inspector container: #zoomBody");const c=document.createElementNS("http://www.w3.org/2000/svg","svg");c.id="zoomSvg",c.setAttribute("xmlns","http://www.w3.org/2000/svg"),c.setAttribute("viewBox","0 0 120 200"),c.setAttribute("role","img"),c.setAttribute("aria-label","Stack column"),o.replaceChildren(c),Oe();const d=document.getElementById("themeDropdown");await Re(e).bindThemeDropdown(d);const l=e.querySelector("#pieces");if(!l)throw new Error("Missing SVG group inside board: #pieces");if(!i||!n)throw new Error("Missing inspector DOM nodes (zoomTitle/zoomHint)");const s=Te(i,n,c),u=Ee(),h=document.getElementById("statusTurn"),g=document.getElementById("statusPhase"),w=document.getElementById("statusMessage");h&&(h.textContent=u.toMove==="B"?"Black":"White"),g&&(g.textContent=u.phase.charAt(0).toUpperCase()+u.phase.slice(1)),w&&(w.textContent="—"),se(e,l,s,u),Ce(e);const p=new Je(e,l,s,u);p.bind();const f=document.getElementById("moveHintsToggle");f&&f.addEventListener("change",()=>{p.setMoveHints(f.checked)});const m=document.getElementById("saveGameBtn"),k=document.getElementById("loadGameBtn"),L=document.getElementById("loadGameInput");m&&m.addEventListener("click",()=>{const S=p.getState(),v=new Date().toISOString().replace(/:/g,"-").split(".")[0];Ze(S,`lasca-game-${v}.json`)}),k&&L&&(k.addEventListener("click",()=>{L.click()}),L.addEventListener("change",async()=>{var v;const S=(v=L.files)==null?void 0:v[0];if(S){try{const y=await qe(S);p.setState(y),se(e,l,s,y);const x=document.getElementById("statusMessage");if(x){const C=x.textContent;x.textContent="Game loaded successfully",setTimeout(()=>{p.setState(y)},1500)}}catch(y){console.error("Failed to load game:",y),alert(`Failed to load game: ${y}`)}L.value=""}}))});
